<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL的锁机制 | 个人博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="./favicon.ico">
    <script>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?55943ae09e5901d7a9f5705133737eec";
              var s = document.getElementsByTagName("script")[0];
              s.parentNode.insertBefore(hm, s);
            })();
           </script>
    <script src="https://hm.baidu.com/hm.js?xxxxxxxxxxx"></script>
    <meta name="description" content="优秀还努力。愿你付出甘之如饴，所得归于欢喜。">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="robots" content="all">
    <meta name="author" content="RenShiWei">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="./assets/css/0.styles.64695689.css" as="style"><link rel="preload" href="./assets/js/app.7a1bd950.js" as="script"><link rel="preload" href="./assets/js/3.cb5ac92f.js" as="script"><link rel="preload" href="./assets/js/1.a307db49.js" as="script"><link rel="preload" href="./assets/js/122.d932197c.js" as="script"><link rel="preload" href="./assets/js/10.6878b594.js" as="script"><link rel="prefetch" href="./assets/js/100.b10893aa.js"><link rel="prefetch" href="./assets/js/101.d1709d30.js"><link rel="prefetch" href="./assets/js/102.1a58a379.js"><link rel="prefetch" href="./assets/js/103.f0c582ac.js"><link rel="prefetch" href="./assets/js/104.04de97cb.js"><link rel="prefetch" href="./assets/js/105.353a5f47.js"><link rel="prefetch" href="./assets/js/106.4af0aeb7.js"><link rel="prefetch" href="./assets/js/107.bf61756d.js"><link rel="prefetch" href="./assets/js/108.0edfb977.js"><link rel="prefetch" href="./assets/js/109.87d4823f.js"><link rel="prefetch" href="./assets/js/11.a3599389.js"><link rel="prefetch" href="./assets/js/110.a5ed1380.js"><link rel="prefetch" href="./assets/js/111.2c649c5b.js"><link rel="prefetch" href="./assets/js/112.17877f4b.js"><link rel="prefetch" href="./assets/js/113.bb372fc4.js"><link rel="prefetch" href="./assets/js/114.41225bb2.js"><link rel="prefetch" href="./assets/js/115.bb36f433.js"><link rel="prefetch" href="./assets/js/116.413121df.js"><link rel="prefetch" href="./assets/js/117.d12e7957.js"><link rel="prefetch" href="./assets/js/118.2de30048.js"><link rel="prefetch" href="./assets/js/119.235e97bf.js"><link rel="prefetch" href="./assets/js/12.59a31928.js"><link rel="prefetch" href="./assets/js/120.5bea2ed7.js"><link rel="prefetch" href="./assets/js/121.584ccdfc.js"><link rel="prefetch" href="./assets/js/123.0d00bf67.js"><link rel="prefetch" href="./assets/js/124.48945d55.js"><link rel="prefetch" href="./assets/js/125.aa08484f.js"><link rel="prefetch" href="./assets/js/126.88020d75.js"><link rel="prefetch" href="./assets/js/127.e1eb2923.js"><link rel="prefetch" href="./assets/js/128.a40cfbfc.js"><link rel="prefetch" href="./assets/js/129.d500888c.js"><link rel="prefetch" href="./assets/js/13.9b2912a8.js"><link rel="prefetch" href="./assets/js/130.3c2fd1e2.js"><link rel="prefetch" href="./assets/js/131.f14e5c6c.js"><link rel="prefetch" href="./assets/js/132.630ca592.js"><link rel="prefetch" href="./assets/js/133.d8b4681d.js"><link rel="prefetch" href="./assets/js/134.5aae6986.js"><link rel="prefetch" href="./assets/js/135.c563fc2d.js"><link rel="prefetch" href="./assets/js/136.64094bd0.js"><link rel="prefetch" href="./assets/js/137.c3b87b3e.js"><link rel="prefetch" href="./assets/js/138.6f748b55.js"><link rel="prefetch" href="./assets/js/139.106d99e8.js"><link rel="prefetch" href="./assets/js/14.6dd6cec3.js"><link rel="prefetch" href="./assets/js/140.444246f2.js"><link rel="prefetch" href="./assets/js/141.f119cc80.js"><link rel="prefetch" href="./assets/js/142.220825fb.js"><link rel="prefetch" href="./assets/js/143.fed637ad.js"><link rel="prefetch" href="./assets/js/144.4531bff4.js"><link rel="prefetch" href="./assets/js/145.f0b31eea.js"><link rel="prefetch" href="./assets/js/146.13b23db3.js"><link rel="prefetch" href="./assets/js/147.67282192.js"><link rel="prefetch" href="./assets/js/148.b28f0004.js"><link rel="prefetch" href="./assets/js/149.d6b42420.js"><link rel="prefetch" href="./assets/js/15.0e49ede8.js"><link rel="prefetch" href="./assets/js/150.9b024b10.js"><link rel="prefetch" href="./assets/js/151.22197513.js"><link rel="prefetch" href="./assets/js/152.626158b2.js"><link rel="prefetch" href="./assets/js/153.53850bec.js"><link rel="prefetch" href="./assets/js/154.b4fb8108.js"><link rel="prefetch" href="./assets/js/155.8f7b080e.js"><link rel="prefetch" href="./assets/js/156.6773b339.js"><link rel="prefetch" href="./assets/js/157.4285458a.js"><link rel="prefetch" href="./assets/js/158.c15e775e.js"><link rel="prefetch" href="./assets/js/159.35d7feff.js"><link rel="prefetch" href="./assets/js/16.d786a69a.js"><link rel="prefetch" href="./assets/js/160.d7ea2332.js"><link rel="prefetch" href="./assets/js/161.2f91cd32.js"><link rel="prefetch" href="./assets/js/162.8465aa6c.js"><link rel="prefetch" href="./assets/js/163.2951de95.js"><link rel="prefetch" href="./assets/js/164.662d2ef2.js"><link rel="prefetch" href="./assets/js/165.4b3397fb.js"><link rel="prefetch" href="./assets/js/166.8d42d4fc.js"><link rel="prefetch" href="./assets/js/167.3a2067b3.js"><link rel="prefetch" href="./assets/js/168.f2919ff5.js"><link rel="prefetch" href="./assets/js/169.74842eab.js"><link rel="prefetch" href="./assets/js/17.a1b91715.js"><link rel="prefetch" href="./assets/js/170.4620ce6d.js"><link rel="prefetch" href="./assets/js/171.68122119.js"><link rel="prefetch" href="./assets/js/172.32b91b88.js"><link rel="prefetch" href="./assets/js/173.cc298090.js"><link rel="prefetch" href="./assets/js/174.4d94dc83.js"><link rel="prefetch" href="./assets/js/175.33b02d87.js"><link rel="prefetch" href="./assets/js/176.f987e538.js"><link rel="prefetch" href="./assets/js/177.da2422e7.js"><link rel="prefetch" href="./assets/js/178.643c910b.js"><link rel="prefetch" href="./assets/js/179.1edc31a3.js"><link rel="prefetch" href="./assets/js/18.04bd315a.js"><link rel="prefetch" href="./assets/js/180.a58e720a.js"><link rel="prefetch" href="./assets/js/181.09c2ec61.js"><link rel="prefetch" href="./assets/js/182.a9f7ba23.js"><link rel="prefetch" href="./assets/js/183.8a0d77ba.js"><link rel="prefetch" href="./assets/js/184.69461209.js"><link rel="prefetch" href="./assets/js/185.531aa09e.js"><link rel="prefetch" href="./assets/js/186.ba00a4f2.js"><link rel="prefetch" href="./assets/js/187.244e37c2.js"><link rel="prefetch" href="./assets/js/188.c69147a3.js"><link rel="prefetch" href="./assets/js/189.c052c66d.js"><link rel="prefetch" href="./assets/js/19.44a5121b.js"><link rel="prefetch" href="./assets/js/190.031eec9a.js"><link rel="prefetch" href="./assets/js/191.f44826ec.js"><link rel="prefetch" href="./assets/js/192.3caaf932.js"><link rel="prefetch" href="./assets/js/193.4f7d20cb.js"><link rel="prefetch" href="./assets/js/194.1a72e492.js"><link rel="prefetch" href="./assets/js/195.a79459e4.js"><link rel="prefetch" href="./assets/js/196.e40c69f1.js"><link rel="prefetch" href="./assets/js/20.9050f00f.js"><link rel="prefetch" href="./assets/js/21.693ec316.js"><link rel="prefetch" href="./assets/js/22.28738cee.js"><link rel="prefetch" href="./assets/js/23.4897735d.js"><link rel="prefetch" href="./assets/js/24.dabeb794.js"><link rel="prefetch" href="./assets/js/25.e02ca12e.js"><link rel="prefetch" href="./assets/js/26.d45a8181.js"><link rel="prefetch" href="./assets/js/27.6aba7760.js"><link rel="prefetch" href="./assets/js/28.7dedcab4.js"><link rel="prefetch" href="./assets/js/29.260e7f7f.js"><link rel="prefetch" href="./assets/js/30.6d7b0433.js"><link rel="prefetch" href="./assets/js/31.32462a85.js"><link rel="prefetch" href="./assets/js/32.f3f5048a.js"><link rel="prefetch" href="./assets/js/33.2688a581.js"><link rel="prefetch" href="./assets/js/34.2500012f.js"><link rel="prefetch" href="./assets/js/35.c446f3ff.js"><link rel="prefetch" href="./assets/js/36.e081800c.js"><link rel="prefetch" href="./assets/js/37.c8d473a1.js"><link rel="prefetch" href="./assets/js/38.0d8a0872.js"><link rel="prefetch" href="./assets/js/39.90069eb2.js"><link rel="prefetch" href="./assets/js/4.807ce41c.js"><link rel="prefetch" href="./assets/js/40.302351ae.js"><link rel="prefetch" href="./assets/js/41.a0814dfe.js"><link rel="prefetch" href="./assets/js/42.2705e772.js"><link rel="prefetch" href="./assets/js/43.85b64651.js"><link rel="prefetch" href="./assets/js/44.7d3180ee.js"><link rel="prefetch" href="./assets/js/45.80e65efe.js"><link rel="prefetch" href="./assets/js/46.429a6bf8.js"><link rel="prefetch" href="./assets/js/47.429c40d0.js"><link rel="prefetch" href="./assets/js/48.d8423860.js"><link rel="prefetch" href="./assets/js/49.bdc9e620.js"><link rel="prefetch" href="./assets/js/5.884d6fa1.js"><link rel="prefetch" href="./assets/js/50.d72ed5ab.js"><link rel="prefetch" href="./assets/js/51.8ed545db.js"><link rel="prefetch" href="./assets/js/52.39629162.js"><link rel="prefetch" href="./assets/js/53.9acad23a.js"><link rel="prefetch" href="./assets/js/54.6bd0a54c.js"><link rel="prefetch" href="./assets/js/55.a691d339.js"><link rel="prefetch" href="./assets/js/56.456d6a62.js"><link rel="prefetch" href="./assets/js/57.dd6a35c2.js"><link rel="prefetch" href="./assets/js/58.56cbe95d.js"><link rel="prefetch" href="./assets/js/59.4944f8de.js"><link rel="prefetch" href="./assets/js/6.dd7a6d69.js"><link rel="prefetch" href="./assets/js/60.e03d8019.js"><link rel="prefetch" href="./assets/js/61.d4f3ffad.js"><link rel="prefetch" href="./assets/js/62.9da7466a.js"><link rel="prefetch" href="./assets/js/63.1f0b1575.js"><link rel="prefetch" href="./assets/js/64.d62cf82f.js"><link rel="prefetch" href="./assets/js/65.6fedb0fa.js"><link rel="prefetch" href="./assets/js/66.e8d95b01.js"><link rel="prefetch" href="./assets/js/67.68f9f524.js"><link rel="prefetch" href="./assets/js/68.687f7c88.js"><link rel="prefetch" href="./assets/js/69.9d3459c6.js"><link rel="prefetch" href="./assets/js/7.2a7f9dde.js"><link rel="prefetch" href="./assets/js/70.a172431d.js"><link rel="prefetch" href="./assets/js/71.74b06b55.js"><link rel="prefetch" href="./assets/js/72.a4a724f7.js"><link rel="prefetch" href="./assets/js/73.7bc4b187.js"><link rel="prefetch" href="./assets/js/74.0f868a30.js"><link rel="prefetch" href="./assets/js/75.721d640d.js"><link rel="prefetch" href="./assets/js/76.bb4f7baf.js"><link rel="prefetch" href="./assets/js/77.8f0c495f.js"><link rel="prefetch" href="./assets/js/78.2db81b89.js"><link rel="prefetch" href="./assets/js/79.2c3afe93.js"><link rel="prefetch" href="./assets/js/8.e71ad162.js"><link rel="prefetch" href="./assets/js/80.82ad2482.js"><link rel="prefetch" href="./assets/js/81.344c57f3.js"><link rel="prefetch" href="./assets/js/82.20917223.js"><link rel="prefetch" href="./assets/js/83.e75fd719.js"><link rel="prefetch" href="./assets/js/84.16c0beda.js"><link rel="prefetch" href="./assets/js/85.bb79c09c.js"><link rel="prefetch" href="./assets/js/86.30354d37.js"><link rel="prefetch" href="./assets/js/87.e09cb22f.js"><link rel="prefetch" href="./assets/js/88.b6c8baac.js"><link rel="prefetch" href="./assets/js/89.6b46241f.js"><link rel="prefetch" href="./assets/js/9.8e556905.js"><link rel="prefetch" href="./assets/js/90.18b0274f.js"><link rel="prefetch" href="./assets/js/91.576afa67.js"><link rel="prefetch" href="./assets/js/92.3f26d552.js"><link rel="prefetch" href="./assets/js/93.f9f38c15.js"><link rel="prefetch" href="./assets/js/94.292cf729.js"><link rel="prefetch" href="./assets/js/95.6d0fbbbc.js"><link rel="prefetch" href="./assets/js/96.4ed56472.js"><link rel="prefetch" href="./assets/js/97.5b3fba34.js"><link rel="prefetch" href="./assets/js/98.8bfb52b6.js"><link rel="prefetch" href="./assets/js/99.3a15be66.js">
    <link rel="stylesheet" href="./assets/css/0.styles.64695689.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Duktig</h3> <p class="description" data-v-59e6cb88>优秀还努力。愿你付出甘之如饴，所得归于欢喜。</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>RenShiWei</span>
          
        <span data-v-59e6cb88>2018 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><img src="./logo.png" alt="个人博客" class="logo"> <span class="site-name">个人博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link"><i class="iconfont reco-home"></i>
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Java
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java 基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./java/basics/面向对象.html" class="nav-link"><i class="undefined"></i>
  Java 基础
</a></li><li class="dropdown-subitem"><a href="/./java/collection/HashMap底层原理分析.html" class="nav-link"><i class="undefined"></i>
  Java 集合
</a></li><li class="dropdown-subitem"><a href="/./java/io/IO基础.html" class="nav-link"><i class="undefined"></i>
  Java IO
</a></li><li class="dropdown-subitem"><a href="/./java/reflect/反射总结.html" class="nav-link"><i class="undefined"></i>
  Java 反射
</a></li><li class="dropdown-subitem"><a href="/./java/thread/多线程基础笔记.html" class="nav-link"><i class="undefined"></i>
  Java 并发编程
</a></li></ul></li><li class="dropdown-item"><h4>JVM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./java/jvm/JVM总结.html" class="nav-link"><i class="undefined"></i>
  JVM总结
</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./java相关框架/spring family/Spring/Spring总结.html" class="nav-link"><i class="undefined"></i>
  Spring总结
</a></li><li class="dropdown-subitem"><a href="/./java相关框架/spring family/Spring/Spring常见面试题.html" class="nav-link"><i class="undefined"></i>
  Spring常见面试题
</a></li><li class="dropdown-subitem"><a href="/./java相关框架/spring family/SpringMVC/SpringMVC.html" class="nav-link"><i class="undefined"></i>
  SpringMVC
</a></li><li class="dropdown-subitem"><a href="/./java相关框架/spring family/SpringBoot/SpringBoot自动装配和Starter原理.html" class="nav-link"><i class="undefined"></i>
  SpringBoot自动装配和Starter原理
</a></li><li class="dropdown-subitem"><a href="/./java相关框架/spring family/SpringBoot/SpringBoot常见面试题.html" class="nav-link"><i class="undefined"></i>
  SpringBoot常见面试题
</a></li></ul></li><li class="dropdown-item"><h4>JWT</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./java相关框架/JWT相关.html" class="nav-link"><i class="undefined"></i>
  JWT总结
</a></li></ul></li><li class="dropdown-item"><h4>Netty</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./java相关框架/Netty/Netty总结.html" class="nav-link"><i class="undefined"></i>
  Netty总结
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      算法
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./算法与数据结构/数据结构/线性表.html" class="nav-link"><i class="undefined"></i>
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/./算法与数据结构/算法技巧/01数组.html" class="nav-link"><i class="undefined"></i>
  算法技巧
</a></li><li class="dropdown-item"><!----> <a href="/./算法与数据结构/codetop/codetop(21-40).html" class="nav-link"><i class="undefined"></i>
  CodeTop
</a></li><li class="dropdown-item"><!----> <a href="/./算法与数据结构/《剑指offer》总结.html" class="nav-link"><i class="undefined"></i>
  剑指offer
</a></li><li class="dropdown-item"><!----> <a href="/./算法与数据结构/真实面试算法题/好朋友的笔试题——1000个1-100随机数尽可能均匀分配区间的问题.html" class="nav-link"><i class="undefined"></i>
  真实面试算法题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      数据库
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./sql/mysql/MySQL索引.html" class="nav-link"><i class="undefined"></i>
  MySQL 详解
</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./sql/redis/Redis底层数据结构.html" class="nav-link"><i class="undefined"></i>
  Redis 详解
</a></li><li class="dropdown-subitem"><a href="/./doc/sql/es/ElasticSearch技术方案——使用场景.html" class="nav-link"><i class="undefined"></i>
  ElasticSearch 详解
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      架构
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./架构/微服务/微服务架构 总览.html" class="nav-link"><i class="undefined"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/./架构/分布式ID/分布式ID方案.html" class="nav-link"><i class="undefined"></i>
  分布式ID
</a></li><li class="dropdown-item"><!----> <a href="/./架构/分布式锁/分布式锁.html" class="nav-link"><i class="undefined"></i>
  分布式锁
</a></li><li class="dropdown-item"><!----> <a href="/./架构/分布式事务/分布式事务方案.html" class="nav-link"><i class="undefined"></i>
  分布式事务
</a></li><li class="dropdown-item"><!----> <a href="/./架构/OAuth2.0/理解OAuth2.0.html" class="nav-link"><i class="undefined"></i>
  OAuth2.0
</a></li><li class="dropdown-item"><!----> <a href="/./架构/云原生/云原生架构和K8S.html" class="nav-link"><i class="undefined"></i>
  云原生
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      大数据
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./大数据/Hadoop/Hadoop概述.html" class="nav-link"><i class="undefined"></i>
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/./大数据/Hive/Hive概述.html" class="nav-link"><i class="undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/./大数据/HBase/HBase.html" class="nav-link"><i class="undefined"></i>
  HBase
</a></li><li class="dropdown-item"><!----> <a href="/./大数据/Flink/flink.html" class="nav-link"><i class="undefined"></i>
  Flink
</a></li></ul></div></div><div class="nav-item"><a href="/./tool/emoji/我的常用emoji.html" class="nav-link"><i class="undefined"></i>
  工具
</a></div><div class="nav-item"><a href="/./aboutme.html" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关注我
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/duktig666" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/duktig666" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/qq_42937522?spm=1000.2115.3001.5343" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/421632ec0dc8" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zhihu.com/people/zui-jing-de-zi-91/posts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-zhihu"></i>
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://twitter.com/duktig666" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-twitter"></i>
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/duktig666/share-blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="./avatar.jpeg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    RenShiWei
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>52</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>33</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41><li class="social-item" data-v-1fad0c41><i class="iconfont reco-github" style="color:#f8b26a;" data-v-1fad0c41></i></li><li class="social-item" data-v-1fad0c41><i class="iconfont reco-mayun" style="color:#f47e60;" data-v-1fad0c41></i></li><li class="social-item" data-v-1fad0c41><i class="iconfont reco-csdn" style="color:#abbd81;" data-v-1fad0c41></i></li><li class="social-item" data-v-1fad0c41><i class="iconfont reco-jianshu" style="color:#3498db;" data-v-1fad0c41></i></li></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link"><i class="iconfont reco-home"></i>
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Java
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java 基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./java/basics/面向对象.html" class="nav-link"><i class="undefined"></i>
  Java 基础
</a></li><li class="dropdown-subitem"><a href="/./java/collection/HashMap底层原理分析.html" class="nav-link"><i class="undefined"></i>
  Java 集合
</a></li><li class="dropdown-subitem"><a href="/./java/io/IO基础.html" class="nav-link"><i class="undefined"></i>
  Java IO
</a></li><li class="dropdown-subitem"><a href="/./java/reflect/反射总结.html" class="nav-link"><i class="undefined"></i>
  Java 反射
</a></li><li class="dropdown-subitem"><a href="/./java/thread/多线程基础笔记.html" class="nav-link"><i class="undefined"></i>
  Java 并发编程
</a></li></ul></li><li class="dropdown-item"><h4>JVM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./java/jvm/JVM总结.html" class="nav-link"><i class="undefined"></i>
  JVM总结
</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./java相关框架/spring family/Spring/Spring总结.html" class="nav-link"><i class="undefined"></i>
  Spring总结
</a></li><li class="dropdown-subitem"><a href="/./java相关框架/spring family/Spring/Spring常见面试题.html" class="nav-link"><i class="undefined"></i>
  Spring常见面试题
</a></li><li class="dropdown-subitem"><a href="/./java相关框架/spring family/SpringMVC/SpringMVC.html" class="nav-link"><i class="undefined"></i>
  SpringMVC
</a></li><li class="dropdown-subitem"><a href="/./java相关框架/spring family/SpringBoot/SpringBoot自动装配和Starter原理.html" class="nav-link"><i class="undefined"></i>
  SpringBoot自动装配和Starter原理
</a></li><li class="dropdown-subitem"><a href="/./java相关框架/spring family/SpringBoot/SpringBoot常见面试题.html" class="nav-link"><i class="undefined"></i>
  SpringBoot常见面试题
</a></li></ul></li><li class="dropdown-item"><h4>JWT</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./java相关框架/JWT相关.html" class="nav-link"><i class="undefined"></i>
  JWT总结
</a></li></ul></li><li class="dropdown-item"><h4>Netty</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./java相关框架/Netty/Netty总结.html" class="nav-link"><i class="undefined"></i>
  Netty总结
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      算法
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./算法与数据结构/数据结构/线性表.html" class="nav-link"><i class="undefined"></i>
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/./算法与数据结构/算法技巧/01数组.html" class="nav-link"><i class="undefined"></i>
  算法技巧
</a></li><li class="dropdown-item"><!----> <a href="/./算法与数据结构/codetop/codetop(21-40).html" class="nav-link"><i class="undefined"></i>
  CodeTop
</a></li><li class="dropdown-item"><!----> <a href="/./算法与数据结构/《剑指offer》总结.html" class="nav-link"><i class="undefined"></i>
  剑指offer
</a></li><li class="dropdown-item"><!----> <a href="/./算法与数据结构/真实面试算法题/好朋友的笔试题——1000个1-100随机数尽可能均匀分配区间的问题.html" class="nav-link"><i class="undefined"></i>
  真实面试算法题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      数据库
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./sql/mysql/MySQL索引.html" class="nav-link"><i class="undefined"></i>
  MySQL 详解
</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/./sql/redis/Redis底层数据结构.html" class="nav-link"><i class="undefined"></i>
  Redis 详解
</a></li><li class="dropdown-subitem"><a href="/./doc/sql/es/ElasticSearch技术方案——使用场景.html" class="nav-link"><i class="undefined"></i>
  ElasticSearch 详解
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      架构
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./架构/微服务/微服务架构 总览.html" class="nav-link"><i class="undefined"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/./架构/分布式ID/分布式ID方案.html" class="nav-link"><i class="undefined"></i>
  分布式ID
</a></li><li class="dropdown-item"><!----> <a href="/./架构/分布式锁/分布式锁.html" class="nav-link"><i class="undefined"></i>
  分布式锁
</a></li><li class="dropdown-item"><!----> <a href="/./架构/分布式事务/分布式事务方案.html" class="nav-link"><i class="undefined"></i>
  分布式事务
</a></li><li class="dropdown-item"><!----> <a href="/./架构/OAuth2.0/理解OAuth2.0.html" class="nav-link"><i class="undefined"></i>
  OAuth2.0
</a></li><li class="dropdown-item"><!----> <a href="/./架构/云原生/云原生架构和K8S.html" class="nav-link"><i class="undefined"></i>
  云原生
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      大数据
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./大数据/Hadoop/Hadoop概述.html" class="nav-link"><i class="undefined"></i>
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/./大数据/Hive/Hive概述.html" class="nav-link"><i class="undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/./大数据/HBase/HBase.html" class="nav-link"><i class="undefined"></i>
  HBase
</a></li><li class="dropdown-item"><!----> <a href="/./大数据/Flink/flink.html" class="nav-link"><i class="undefined"></i>
  Flink
</a></li></ul></div></div><div class="nav-item"><a href="/./tool/emoji/我的常用emoji.html" class="nav-link"><i class="undefined"></i>
  工具
</a></div><div class="nav-item"><a href="/./aboutme.html" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关注我
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/duktig666" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/duktig666" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/qq_42937522?spm=1000.2115.3001.5343" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/421632ec0dc8" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zhihu.com/people/zui-jing-de-zi-91/posts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-zhihu"></i>
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://twitter.com/duktig666" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-twitter"></i>
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/duktig666/share-blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Mysql</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./2022/01/21/mysql%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%9C%89%E5%93%AA%E4%BA%9B-%E4%BB%A5%E5%8F%8A%E5%AE%83%E4%BB%AC%E7%9A%84%E5%AF%B9%E6%AF%94%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/" class="sidebar-link">MySQL的存储引擎有哪些？以及它们的对比和使用场景</a></li><li><a href="/./2022/01/21/mysql%E7%B4%A2%E5%BC%95/" class="sidebar-link">MySQL索引</a></li><li><a href="/./2022/01/21/mysql-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A6%81%E7%94%A8b-%E6%A0%91%E5%AD%98%E5%82%A8%E7%B4%A2%E5%BC%95/" class="sidebar-link">MySQL 数据库要用B+树存储索引？</a></li><li><a href="/./2022/01/21/mysql%E7%9A%84%E4%BA%8B%E5%8A%A1%E3%80%81%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E5%92%8Cmvcc%E5%8E%9F%E7%90%86/" class="sidebar-link">MySQL的事务、隔离级别和MVCC原理</a></li><li><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/" aria-current="page" class="active sidebar-link">MySQL的锁机制</a></li><li><a href="/./2022/01/21/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%92%8C%E5%88%86%E8%A1%A8%E5%88%86%E5%BA%93%E5%8E%9F%E7%90%86/" class="sidebar-link">MySQL主从复制和分表分库原理</a></li><li><a href="/./2022/01/21/mysql%E7%9A%84%E6%85%A2%E6%9F%A5%E8%AF%A2%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/" class="sidebar-link">MySQL的慢查询和数据库优化</a></li><li><a href="/./2022/01/21/sql%E7%BC%96%E7%A8%8B%E9%A2%98/" class="sidebar-link">sql编程题</a></li><li><a href="/./2022/01/21/%E5%BC%80%E7%AA%97%E5%87%BD%E6%95%B0/" class="sidebar-link">开窗函数</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./2022/01/21/redis%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="sidebar-link">Redis的底层数据结构</a></li><li><a href="/./2021/12/14/redis%E7%9A%84%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/" class="sidebar-link">Redis的发布订阅模式</a></li><li><a href="/./2022/01/21/redis%E9%9D%A2%E8%AF%95%E9%A2%98/" class="sidebar-link">Redis面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ElasticSearch</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./2021/02/28/elasticsearch%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/" class="sidebar-link">ElasticSearch技术方案——使用场景</a></li><li><a href="/./2021/03/05/elasticsearch%E5%AE%9E%E7%8E%B0%E7%AB%99%E5%86%85%E6%90%9C%E7%B4%A2/" class="sidebar-link">ElasticSearch实现站内搜索</a></li><li><a href="/./2020/01/01/es%E9%87%8D%E7%82%B9/" class="sidebar-link">ES重点</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>MySQL的锁机制</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>RenShiWei</span>
          
        <span data-v-59e6cb88>2018 - </span>
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">MySQL的锁机制</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>RenShiWei</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2022/1/21</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="mysql的锁"><a href="#mysql的锁" class="header-anchor">#</a> MySQL的锁</h1> <p>本篇文章提到的锁，如果没有特别说明，默认指InnoDB的锁。</p> <h2 id="mysql加锁的目的是什么"><a href="#mysql加锁的目的是什么" class="header-anchor">#</a> MySQL加锁的目的是什么？</h2> <p>数据库的锁是为了解决事务的隔离性问题，为了让事务之间相互不影响，每个事务进行操作的时候都会对数据加上一把特有的锁，防止其他事务同时操作数据。</p> <h2 id="mysql的锁是基于什么实现的"><a href="#mysql的锁是基于什么实现的" class="header-anchor">#</a> MySQL的锁是基于什么实现的？</h2> <p>数据库里面的锁是基于索引实现的，在Innodb中我们的锁都是作用在索引上面的，当我们的SQL命中索引时，那么锁住的就是命中条件内的索引节点(行锁)，如果没有命中索引的话，那我们锁的就是整个索引树（表锁）。</p> <h2 id="解决并发事务问题的方式"><a href="#解决并发事务问题的方式" class="header-anchor">#</a> 解决并发事务问题的方式</h2> <h3 id="写写情况"><a href="#写写情况" class="header-anchor">#</a> 写写情况</h3> <p>任何一种隔离级别都不允许出现脏写现象，是通过加锁来实现的。锁结构两个比较重要的属性：</p> <ul><li>trx信息：表示锁结构与哪个事务有关。</li> <li>is_waiting：表示当前事务是否在等待。</li></ul> <p>锁获取的状态：</p> <ul><li>获取锁成功：内存中生成了对应的锁结构，而且is_waiting的值为false。（除了隐式锁）</li> <li>获取锁失败：内存中生成了对应的锁结构，而且is_waiting的值为true，事务需要等待。</li> <li>不加锁：内存中没有生成锁结构，可以直接操作。（不包括隐式锁）</li></ul> <p>释放锁：释放锁，发现还有事务等待锁，修改对应锁结构is_waiting的值为true。</p> <h3 id="读写或写读情况"><a href="#读写或写读情况" class="header-anchor">#</a> 读写或写读情况</h3> <p><strong>方案1：读操作使用MVCC，写操作加锁</strong></p> <p>MVCC通过ReadView找到符合条件的记录版本，<strong>查询语句只能读到在生成ReadView之前已经提交的事务所做的更改</strong>，在生成ReadView之前未提交或者之后才开启的事务所做的修改操作是看不到的。</p> <p>写操作针对最新版本的记录，读记录的历史版本和改动记录的最新版本是不冲突的。</p> <p>方案2：读写操作都加锁</p> <h3 id="一致性读"><a href="#一致性读" class="header-anchor">#</a> 一致性读</h3> <p>事务利用MVCC方式，读写操作不冲突称之为一致性读。</p> <p>一致性读并不会对表中的任何记录进行加锁，其他事务可以自由对表中的记录进行改动。</p> <h3 id="锁定读"><a href="#锁定读" class="header-anchor">#</a> 锁定读</h3> <p>对记录加S锁：<code>SELECT …… LOCK IN SHARE MODE</code></p> <p>对记录加X锁：<code>SELECT …… FOR UPDATE</code></p> <h3 id="写操作"><a href="#写操作" class="header-anchor">#</a> 写操作</h3> <h4 id="delete"><a href="#delete" class="header-anchor">#</a> DELETE</h4> <ol><li>先在B+树中定位到记录，然后获取X锁，最后执行 delete mark 操作（添加删除标记）</li></ol> <h4 id="update"><a href="#update" class="header-anchor">#</a> UPDATE</h4> <ul><li><strong>未修改主键值，并且被更新的列所占用的存储空间未改变</strong>：定位到B+树的记录位置，获取X锁，修改值。</li> <li><strong>未修改主键值，并且被更新的列至少有一个所占用的存储空间改变</strong>：定位到B+树的记录位置，获取X锁，彻底删除记录（而不是delete mark），然后再新增记录。</li> <li><strong>修改记录的键值</strong>：定位到B+树的记录位置，获取X锁，执行DELETE操作，然后再执行INSERT操作。</li></ul> <h4 id="insert"><a href="#insert" class="header-anchor">#</a> INSERT</h4> <p>一般情况下，新插入记录受隐式锁保护，不生成对应的锁结构。</p> <h2 id="锁的内存结构"><a href="#锁的内存结构" class="header-anchor">#</a> 锁的内存结构</h2> <h3 id="基本介绍"><a href="#基本介绍" class="header-anchor">#</a> 基本介绍</h3> <p>“锁”本质上是内存中的结构，在事务执行之前是没有锁的（也就是说一开始是没有锁结构与记录进行关联的）。</p> <p>当一个事务相对这条记录进行改动时，首先会看内存中有没有与这条记录相关联的锁结构；如果没有，就在内存中生成一个锁结构与记录相关联。</p> <p>锁结构有很多信息，<strong>比较重要的属性如下</strong>：</p> <ul><li><code>trx</code>信息：表示这个锁结构与哪个事务相关联。</li> <li><code>is_waiting</code>：表示当前事务是否在等待。</li> <li><code>type</code>：表示锁的类型。</li></ul> <h3 id="锁结构的变化"><a href="#锁结构的变化" class="header-anchor">#</a> <strong>锁结构的变化：</strong></h3> <ol><li>事务T1修改记录前，生成锁结构（因为之前没有别的事务为这条记录加锁）：<code>trx:T1 is_waiting:false</code>。称这个操作为加锁成功。</li> <li>事务T1提交前，事务T2也想修改这条记录。在内存中发现有一个锁记录，T2也生成一个所记录<code>trx:T2 is_waiting:true</code>，表示需要等待，称为加锁失败。</li> <li>事务T1提交后，就会把它生成的锁机构释放掉，然后检测一次是否还有与这条记录相关联的锁结构。发现事务T2在等待获取锁，所以把事务T2的 <code>is_waiting:true</code> 改为 <code>false</code>
，然后把该事物对应的线程唤醒，让T2继续执行。此时T2就获取到锁了。</li></ol> <h3 id="哪些记录可以放在一个锁结构中"><a href="#哪些记录可以放在一个锁结构中" class="header-anchor">#</a> 哪些记录可以放在一个锁结构中？</h3> <p>上文提到：对一条记录加锁的本质是在内存中创建一个锁结构与之关联（隐式锁除外）。</p> <p>但是一个事务对多条记录加锁，是不是要创建多个锁结构？如果加锁记录太多，岂不是造成了内存占用太大。</p> <p>所以，如果符合以下条件，这些记录的锁可以放到一个锁结构中：</p> <ol><li>在同一个事务中进行加锁操作</li> <li>被加锁的记录在同一个页面中</li> <li>加锁的类型是一样的</li> <li>等待状态是一样的</li></ol> <h3 id="锁结构详解"><a href="#锁结构详解" class="header-anchor">#</a> 锁结构详解</h3> <img src="https://typecho-1300745270.cos.ap-shanghai.myqcloud.com/typora/202203022325296.jpg" alt="271a340123d72197fd99faa32c1190b" style="zoom:67%;"> <ul><li>锁所在事务信息和索引信息 在内存结构中是一个指针，不会占用太大空间</li> <li>表锁/行锁信息：
<ul><li>表锁记载着这是对哪个表加的锁</li> <li>行锁记载下面3个重要信息：
<ul><li>Space ID：记录所在的表空间</li> <li>Page Number：记录所在的页号</li> <li>n_bits：对于行锁来说，一条记录对用一个比特。用以区分哪些记录被加了行锁，n_bits为了让页面插入新记录时不至于重新分配锁结构，一般来说会比页面记录多一些。</li></ul></li></ul></li> <li>type_mode：是一个32比特的数，分为 lock_mode、lock_type、rec_lock_type
三部分。<img src="https://typecho-1300745270.cos.ap-shanghai.myqcloud.com/typora/202203022332392.jpg" alt="91bb6399110c93e44260472028a69fc"> <ul><li>lock_mode（锁模式）占用4比特，具体如下：
<ul><li>LOCK_IS（十进制0）</li> <li>LOCK_IX（十进制1）</li> <li>LOCK_S（十进制2）</li> <li>LOCK_X（十进制3）</li> <li>LOCK_AUTO_INC（十进制4）</li></ul></li> <li>lock_type（锁类型）占5~8位，现阶段只用了第5位和第6位
<ul><li>LOCK_TABLE（十进制16）：第5位为1，表级锁</li> <li>LOCK_REC（十进制32）：第6位为1，行级锁</li></ul></li> <li>rec_lock_type（行锁的具体类型），只有在lock_type值为LOCK_REC时，才会细分更多的类型
<ul><li>LOCK_ORDINARY（十进制0）：表示next-key锁（临键锁）</li> <li>LOCK_GAP（十进制512）：第10比特位为1，表示gap（间隙）锁</li> <li>LOCK_REC_NOT_GAP（十进制1024）：第11比特位为1，表示记录锁</li> <li>LOCK_INSERT_INTENTION（十进制2048）：第12比特位为1，表示插入意向锁</li> <li>其他类型</li> <li>LOCK_WAIT（十进制256）：第9比特位为1，is_waiting表示为true。</li></ul></li> <li>一堆比特位：每个比特位，表示锁结构对应一条记录。</li></ul></li></ul> <h2 id="锁的分类"><a href="#锁的分类" class="header-anchor">#</a> 锁的分类</h2> <p>基于锁的属性分类：共享锁、排他锁。</p> <p>基于锁的粒度分类：表锁、行锁、记录锁、间隙锁、临键锁、自增锁。</p> <p>基于锁的状态分类：意向共享锁、意向排它锁。</p> <p>基于加锁的态度分类：悲观锁、乐观锁。</p> <h2 id="共享锁和排它锁-读写锁"><a href="#共享锁和排它锁-读写锁" class="header-anchor">#</a> 共享锁和排它锁（读写锁）</h2> <h3 id="共享锁"><a href="#共享锁" class="header-anchor">#</a> 共享锁</h3> <p><strong>共享锁</strong>又称读锁，简称S锁；当一个事务为数据加上读锁之后，<strong>其他事务只能对该数据加读锁，而不能对数据加写锁</strong>，直到所有的读锁释放之后其他事务才能对其进行加持写锁。</p> <p>共享锁的特性主要是为了支持并发的读取数据，读取数据的时候不支持修改，避免出现重复读的问题。</p> <p><img src="https://typecho-1300745270.cos.ap-shanghai.myqcloud.com/typora/202111051714836.png" alt="共享锁"></p> <h3 id="排它锁"><a href="#排它锁" class="header-anchor">#</a> 排它锁</h3> <p>排他锁又称写锁，简称X锁；当一个事务为数据加上写锁时，其他请求将不能再为数据加任何锁，直到该锁释放之后，其他事务才能对数据进行加锁。</p> <p>排他锁的目的是在数据修改时候，不允许其他人同时修改，也不允许其他人读取。避免了出现脏数据和脏读的问题。</p> <p><img src="https://typecho-1300745270.cos.ap-shanghai.myqcloud.com/typora/202111051729003.png" alt="排它锁"></p> <h2 id="读写意向锁"><a href="#读写意向锁" class="header-anchor">#</a> 读写意向锁</h2> <p>意向锁也是表级锁，也可分为读意向锁（IS 锁）和写意向锁（IX 锁）。分为如下情况：</p> <ul><li>某条记录加S锁时，需要先在表级别加IS锁。</li> <li>某条记录加X锁时，需要先在表级别加IX锁。</li> <li>加表级别S锁时，此表不能加有IX锁。</li> <li>加表级别X锁时，此表不能加有IS、IX锁。</li></ul> <p>意向锁是为了，在加表级别S、X锁时，快速判断表中记录是否被上锁，避免遍历该表的所有记录。</p> <h2 id="表锁"><a href="#表锁" class="header-anchor">#</a> 表锁</h2> <h3 id="什么是表锁"><a href="#什么是表锁" class="header-anchor">#</a> 什么是表锁？</h3> <p><strong>表锁</strong>是指上锁的时候锁住的是整个表，当下一个事务访问该表的时候，必须等前一个事务释放了锁才能进行对表进行访问；</p> <p>表锁由 MySQL Server 实现，一般在执行 DDL 语句时会对整个表进行加锁，比如说 ALTER TABLE 等操作。</p> <p>表锁的特点： <strong>粒度大，加锁简单，容易冲突</strong>。</p> <h3 id="显式加表锁"><a href="#显式加表锁" class="header-anchor">#</a> 显式加表锁</h3> <p>在执行 SQL 语句时，也可以明确指定对某个表进行加锁：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#</span>
分为读锁和写锁
<span class="token keyword">lock</span> <span class="token keyword">table</span> <span class="token keyword">user</span> <span class="token keyword">read</span><span class="token punctuation">(</span><span class="token keyword">write</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">#</span>
成功
<span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> <span class="token keyword">user</span>
<span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">#</span>
失败
，未提前获取该 role的读表锁
<span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> role
<span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">#</span>
失败
，未提前获得<span class="token keyword">user</span>的写表锁
<span class="token keyword">update</span> <span class="token keyword">user</span>
<span class="token keyword">set</span> name <span class="token operator">=</span> <span class="token string">'Tom'</span>
<span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">#</span>
显示释放表锁
<span class="token keyword">unlock</span> <span class="token keyword">tables</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>表锁使用的是一次性锁技术，也就是说，在会话开始的地方使用 lock 命令将后续需要用到的表都加上锁，在表释放前，只能访问这些加锁的表，不能访问其他表，直到最后通过 unlock tables 释放所有表锁。</p> <h3 id="什么时候释放表锁"><a href="#什么时候释放表锁" class="header-anchor">#</a> <strong>什么时候释放表锁</strong>？</h3> <ul><li>使用 <code>unlock tables</code> 显示释放锁</li> <li>会话持有其他表锁时执行 <code>lock table</code> 语句会释放会话之前持有的锁</li> <li>会话持有其他表锁时执行 <code>start transaction</code> 或者 <code>begin</code> 开启事务时，也会释放之前持有的锁。</li></ul> <h3 id="表级别的s锁、x锁"><a href="#表级别的s锁、x锁" class="header-anchor">#</a> 表级别的S锁、X锁</h3> <p>表级别的锁一般用在执行 <code>ALTER TABLE</code> 或 <code>DROP TABLE</code>的DDL语句时，然后再执行增删改查时会阻塞。</p> <h3 id="表级别的is锁、ix锁"><a href="#表级别的is锁、ix锁" class="header-anchor">#</a> 表级别的IS锁、IX锁</h3> <p>参看上述的读写意向锁</p> <h3 id="表级别的auto-inc锁"><a href="#表级别的auto-inc锁" class="header-anchor">#</a> 表级别的AUTO-INC锁</h3> <p>AUTO-INC 锁又叫自增锁（一般简写成 AI 锁），是一种表锁，当表中有自增列（AUTO_INCREMENT）时出现。</p> <p>主要实现方式有两种：</p> <ol><li><strong>采用AUTO-INC锁</strong>。执行插入语句时，加一个表级别的AUTO-INC锁，然后为每条待插入记录的AUTO_INCREMENT列分配递增的值，插入执行完毕，锁释放。</li> <li><strong>采用一种轻量级的锁</strong>（mutex，MySQL 从 5.1.22 版本开始引入）。生成自增值后释放，而不是要等插入完成才释放锁。</li></ol> <p><code>innodb_autoinc_lock_mode</code>来控制使用哪种锁：</p> <ul><li>值为0，一律使用AUTO-INC锁</li> <li>值为1，插入数量确定使用轻量级锁，不确定使用AUTO-INC锁</li> <li>值为2，一律使用轻量级锁（不同事务自增列值交叉，主从复制不安全）</li></ul> <p><strong>注意事项：</strong></p> <p>当插入表中有自增列时，数据库需要自动生成自增值，它会<strong>先为该表加 AUTOINC 表锁，阻塞其他事务的插入操作，这样保证生成的自增值肯定是唯一的</strong>。</p> <p>AUTOINC 锁具有如下特点：</p> <ul><li>AUTO_INC 锁互不兼容，也就是说同一张表同时只允许有一个自增锁；</li> <li>自增值一旦分配了就会 +1，如果<strong>事务回滚，自增值也不会减回去</strong>，所以自增值可能会出现中断的情况。</li></ul> <h2 id="行锁"><a href="#行锁" class="header-anchor">#</a> 行锁</h2> <h3 id="什么是行锁"><a href="#什么是行锁" class="header-anchor">#</a> 什么是行锁？</h3> <p>行锁是指上锁的时候锁住的是表的某一行或多行记录，其他事务访问同一张表时，只有被锁住的记录不能访问，其他的记录可正常访问；</p> <p>不同存储引擎的行锁实现不同。</p> <p>特点：<strong>粒度小，加锁比表锁麻烦，不容易冲突，相比表锁支持的并发要高</strong>；</p> <h3 id="行锁的原理"><a href="#行锁的原理" class="header-anchor">#</a> 行锁的原理</h3> <p>行锁的原理和索引有关。</p> <p>InnoDB 是聚簇索引，也就是 B+树的叶节点既存储了主键索引也存储了数据行。而 InnoDB 的二级索引的叶节点存储的则是主键值，所以通过二级索引查询数据时，还需要拿对应的主键去聚簇索引中再次进行查询。</p> <p><strong>单行记录行锁原理</strong></p> <p>下面以两条 SQL 的执行为例，讲解一下 InnoDB 对于单行数据的加锁原理。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#</span>
聚簇索引执行修改
<span class="token keyword">update</span> <span class="token keyword">user</span>
<span class="token keyword">set</span> age <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">49</span><span class="token punctuation">;</span>
<span class="token comment">#</span>
二级索引执行修改
<span class="token keyword">update</span> <span class="token keyword">user</span>
<span class="token keyword">set</span> age <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'Tom'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>第一条 SQL 使用主键索引来查询，则只需要在 id = 49 这个主键索引上加上写锁；</p> <p>第二条 SQL 则使用二级索引来查询，则首先在 name = Tom 这个索引上加写锁，然后由于使用 InnoDB 二级索引还需再次根据主键索引查询，所以还需要在 id = 49 这个主键索引上加写锁。</p> <p><strong>多行记录行锁原理</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">update</span> <span class="token keyword">user</span>
<span class="token keyword">set</span> age <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">where</span> id <span class="token operator">&gt;</span> <span class="token number">49</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>MySQL Server 会根据 WHERE 条件读取第一条满足条件的记录，然后 InnoDB 引擎会将第一条记录返回并加锁，接着 MySQL Server 发起更新改行记录的 UPDATE
请求，更新这条记录。一条记录操作完成，再读取下一条记录，直至没有匹配的记录为止。</p> <p>当然这中间还有很多的优化，就不细细阐述了。</p> <h3 id="行锁的类型"><a href="#行锁的类型" class="header-anchor">#</a> 行锁的类型</h3> <p>根据锁的粒度可以把锁细分为表锁和行锁，行锁根据场景的不同又可以进一步细分，依次为 Next-Key Lock，Gap Lock 间隙锁，Record Lock 记录锁和插入意向 GAP 锁。</p> <p>不同的锁锁定的位置是不同的，比如说记录锁只锁住对应的记录，而间隙锁锁住记录和记录之间的间隔，Next-Key Lock 则所属记录和记录之前的间隙。</p> <p><img src="https://typecho-1300745270.cos.ap-shanghai.myqcloud.com/typora/202111051714635.png" alt="行锁的范围"></p> <h3 id="记录锁-record-lock"><a href="#记录锁-record-lock" class="header-anchor">#</a> 记录锁（Record Lock）</h3> <p><strong>记录锁</strong>：事务在加锁后锁住的只是表的某一条记录。(官方命名LOCK_REC_NOT_GAP)</p> <p><strong>大致触发条件：</strong></p> <ul><li>精准条件命中，并且命中的条件字段是唯一索引。
<ul><li><strong>例如：</strong><code>update user_info set name=’张三’ where id=1</code>     ，这里的id是唯一索引。</li></ul></li> <li>当 SQL 语句无法使用索引时，会进行全表扫描，这个时候 MySQL 会给整张表的所有数据行加记录锁，再由 MySQL Server 层进行过滤。但是，在 MySQL Server 层进行过滤的时候，如果发现不满足 WHERE
条件，会释放对应记录的锁。这样做，保证了最后只会持有满足条件记录上的锁，但是每条记录的加锁操作还是不能省略的。</li></ul> <p>所以更新操作必须要根据索引进行操作，没有索引时，不仅会消耗大量的锁资源，增加数据库的开销，还会极大的降低了数据库的并发性能。</p> <p><strong>记录锁的作用：<strong>加了记录锁之后数据可以</strong>避免数据在查询的时候被修改的重复读问题</strong>，<strong>也避免了在修改的事务未提交前被其他事务读取的脏读问题</strong>。</p> <h3 id="间隙锁-gap-lock"><a href="#间隙锁-gap-lock" class="header-anchor">#</a> <strong>间隙锁（Gap Lock）</strong></h3> <p><strong>间隙锁</strong>：在事务加锁后其锁住的是表记录的某一个区间，当表的相邻ID之间出现空隙则会形成一个区间，遵循<strong>左开右闭</strong>原则。</p> <p>比如下面的表里面的数据ID 为 1,4,5,7,10 ,那么会形成以下几个间隙区间，-n-1区间，1-4区间，7-10区间，10-n区间 （-n代表负无穷大，n代表正无穷大）</p> <p><img src="https://typecho-1300745270.cos.ap-shanghai.myqcloud.com/typora/202111051721479.png" alt="间隙锁"></p> <p>**大致触发条件：**范围查询并且查询未命中记录，查询条件必须命中索引、间隙锁只会出现在REPEATABLE_READ（重复读)的事务级别中。</p> <p><strong>例如</strong>：对应上图的表执行 <code>select * from user_info where id&gt;1 and id&lt;4</code> (这里的id是唯一索引) ，这个SQL查询不到对应的记录，那么此时会使用间隙锁。</p> <p>注意事项：</p> <ul><li><code>Infimum</code>：表示页面最小记录</li> <li><code>Supremum</code>：表示页面最大记录</li></ul> <p><strong>间隙锁作用</strong>：<strong>防止幻读问题</strong>。</p> <h3 id="临键锁-next-key-lock"><a href="#临键锁-next-key-lock" class="header-anchor">#</a> <strong>临键锁(Next-Key Lock)</strong></h3> <p>临键锁：<strong>是INNODB的行锁默认算法</strong>，总结来说它就是记录锁和间隙锁的组合，<strong>临键锁会把查询出来的记录锁住，同时也会把该范围查询内的所有间隙空间也会锁住，再之它会把相邻的下一个区间也会锁住</strong>。</p> <p>**例如：**下面表的数据执行 <code>select * from user_info where id&gt;1 and id&lt;=13 for update ;</code></p> <p>会锁住ID为 1,5,10的记录；同时会锁住，1至5,5至10,10至15的区间。</p> <p><img src="https://pic1.zhimg.com/80/v2-8c9555f753fbab98c71760ddba9e5068_720w.png" alt="img"></p> <p>**大致触发条件：**范围查询并命中，查询命中了索引。</p> <p>**临键锁的作用：**结合记录锁和间隙锁的特性，<strong>临键锁避免了在范围查询时出现脏读、重复读、幻读问题</strong>。加了临键锁之后，在范围区间内数据不允许被修改和插入。</p> <h3 id="插入意向锁-lock-insert-intention"><a href="#插入意向锁-lock-insert-intention" class="header-anchor">#</a> 插入意向锁（LOCK_INSERT_INTENTION）</h3> <p>插入意向锁是一种特殊的间隙锁（Insert Intention Lock）表示插入的意向，只有在 INSERT 的时候才会有这个锁。</p> <p>一个事务插入一条记录，需要判断插入位置是否被别的事务加了gap锁（包含next-key锁）。如果有的话，插入操作需要等待，直到加gap锁的事务提交。</p> <h3 id="隐式锁"><a href="#隐式锁" class="header-anchor">#</a> 隐式锁</h3> <p>一般执行Insert不需要在内存中生成锁结构（当然如果插入的间隙被其他事务加了gap锁，那么本次Insert操作会阻塞，当前事务会在间隙插入意向锁）。</p> <p>但这样可能会出现问题。举例，先插入一条记录（无关联锁结构），然后如下情况：</p> <ul><li>立即使用<code>SELECT …… LOCK IN SHARE MODE</code> 或 <code>SELECT …… FOR UPDATE</code>，进行锁定读，获取锁。如果允许，那么出现脏读怎么办？</li> <li>立即修改这条记录（获取锁），怎么办？</li></ul> <p>这些情况下，事务id要起作用了</p> <ul><li></li></ul> <p>对于聚簇索引：trx_id是一个隐藏列，记录最后改动的事务id。新插入记录，trx_id为当前事务的id，如果想加锁，会看trx_id是否是活跃事务。如果不是，正常获取；如果是，帮助当前事务建立X锁的锁结构，is_writing为false。然后自己也创建一个锁结构，is_writing为true，进入等待状态。</p> <ul><li>对于二级索引： 二级索引页面的Page Header的PAGE_MAX_TRX_ID记录改动最大的事务id。如果PAGE_MAX_TRX_ID小于当前最小活跃事务id，表明已提交，否则需要定位的聚簇索引，然后执行上述的操作。</li></ul> <p>所以，一个事务新插入记录可以不显示加锁，这个事务id相当于加了一个隐式锁。别的事务加锁，由于隐式锁存在，会给当前事务生成一个锁结构，然后给自己也生成锁结构，并且进入等待状态。</p> <p><strong>隐式锁作用：延迟生成锁结构。如果事务执行不需要获取与该隐式锁相冲突的锁，可以避免建立锁结构。</strong></p> <p>特殊情况：</p> <ol><li>插入时遇到重复键会报错，但在报错前会加锁
<ol><li>主键（聚簇索引）重复，读提交下加记录锁，可重复读下加临键锁</li> <li>二级唯一索引重复，加临键锁。</li></ol></li> <li>外键检查
<ol><li>待查记录在外键表中可以找到，父表给该记录加记录锁</li> <li>找不到时，读提交不加锁，可重复读加gap锁。</li></ol></li></ol> <h2 id="加锁语句分析"><a href="#加锁语句分析" class="header-anchor">#</a> 加锁语句分析</h2> <h3 id="普通select语句"><a href="#普通select语句" class="header-anchor">#</a> 普通SELECT语句</h3> <p>在不同隔离级别下，普通的SELECT语句具有不同的表现：</p> <ul><li>在 读未提交 隔离级别下，不加锁，直接读取记录的最新版本；可能出现脏读、不可重复读和幻读现象。</li> <li>在 读已提交 隔离级别下，不加锁；在每次执行普通SELECT语句的时候会生成一个ReadView；这样避免了脏读现象，但是没有避免不可重复读和幻读现象。</li> <li>在 可重复读
隔离级别下，不加锁；只在第一次执行普通SELECT语句时生成一个ReadView，这样可以避免脏读和不可重复读，不能完全避免幻读问题（存在特殊情况：事务T1查询出10条记录，事务未提交；事务T2，插入一条记录，提交；事务T1修改了刚刚事务T2插入的记录，那么再次查询时，事务T1会查询出11条数据）。</li> <li>在 串行化 隔离级别下，分为两种情况：
<ul><li>系统变量 <code>autocommit=0</code>时（禁用自动提交），普通的SELECT查询会转换为<code>SELECT …… LOCK IN SHARE MODE</code> 这样的语句。也就是在读记录前需要先获取记录的S锁。具体加锁情况与 可重复读
情况下一样。</li> <li>系统变量<code>autocommit=1</code>时，普通SELECT语句不加锁，只是利用MVCC生成一个ReadView读取记录。为什么呢？因为启动自动提交，意味着一个事务只包含一条语句，而执行一条语句不会出现不可重复读、幻读这样的现象。</li></ul></li></ul> <h3 id="锁定读的语句"><a href="#锁定读的语句" class="header-anchor">#</a> 锁定读的语句</h3> <h4 id="锁定读的语句-2"><a href="#锁定读的语句-2" class="header-anchor">#</a> 锁定读的语句</h4> <ul><li>语句1：<code>SELECT …… LOCK IN SHARE MODE;</code></li> <li>语句2：<code>SELECT …… FOR UPDATE;</code></li> <li>语句3：<code>UPDATE ……</code></li> <li>语句4：<code>DELETC ……</code></li></ul> <p>语句1和2是MySQL中规定的两种锁定读的语法格式，而语句3和4在执行中需要先定位到被改动的记录并给记录加锁，因此也可以任务是锁定读。</p> <p>在了解锁定读语句加锁之前，引入两个概念：匹配模式和唯一性搜索。</p> <h4 id="匹配模式"><a href="#匹配模式" class="header-anchor">#</a> 匹配模式</h4> <p>使用索引执行查询时，查询优化器首先会生成若干个扫描区间。针对每个扫描区间，可以快速定位到第一条记录，然后沿着这条记录所在的单链表可以扫描这个区间的其他记录，直到某条记录不在这个区间为止。如果被扫描的区间是一个单节点扫描区间，可以说此时的匹配模式是 **
精确匹配**。</p> <p>举例：联合索引idx_a_b(a,b)，</p> <ul><li>边界条件时 <code>a=1</code>，扫描区间为[1,1]，是单节点扫描区间，属于精确匹配。</li> <li>边界条件时 <code>a=1 AND b=1</code>，扫描区间为[(1,1),(1,1)]，是单节点扫描区间，属于精确匹配。</li> <li>边界条件时 <code>a=1 AND b&gt;=1</code>，扫描区间为[(1,1),(1,+∞)]，是单节点扫描区间，属于精确匹配。</li></ul> <h4 id="唯一性搜索"><a href="#唯一性搜索" class="header-anchor">#</a> 唯一性搜索</h4> <p>如果扫描之前，事先知道扫描区间最多包含一条记录，把这种情况称为 <strong>唯一性搜索</strong>。</p> <p>怎么确定最多只包含一条记录：</p> <ul><li>匹配模式为精确匹配</li> <li>使用的索引是主键或是唯一二级索引；如果使用的是唯一二级索引，搜索条件不能是<code>索引列 IS NULL</code>的形式（因为对一唯一二级索引列来说，可以存储多个值为NULL的记录）</li> <li>如果索引中包含多个列，那么在生成扫描区间时，每一个都得被用到</li></ul> <h4 id="影响语句加锁的因素"><a href="#影响语句加锁的因素" class="header-anchor">#</a> 影响语句加锁的因素</h4> <ul><li>事务的隔离级别</li> <li>语句执行时使用的索引类型</li> <li>是否是精确匹配</li> <li>是否是唯一性搜索</li> <li>具体的语句类型（SELECT、UPDATE、INSERT、FELETE）</li></ul> <h4 id="读取某个扫描区间中记录的加锁过程"><a href="#读取某个扫描区间中记录的加锁过程" class="header-anchor">#</a> 读取某个扫描区间中记录的加锁过程</h4> <p><strong>读取某个扫描区间的记录加锁情况如下：</strong></p> <p>步骤1：首先快速地在B+树叶子节点中定位到该扫描区间中的第一条记录，把该记录作为当前记录。</p> <p>步骤2：为当前记录加锁。</p> <p>一般情况下，对于锁定读的语句，在隔离级别不大于 <strong>读提交</strong> 时，会为当前记录加记录锁。在隔离级别不小于 <strong>可重复读</strong> 时，会为记录加临键锁。</p> <p>步骤3：判断索引下推的条件是否成立。</p> <p><strong>索引下推，是来把查询中与被使用索引有关的搜索条件下推的存储引擎中判断，而不是返回server层再判断</strong>。索引下推只是为了减少回表次数，只适用于二级索引和SELECT语句。</p> <p>符合索引下推条件，跳到第四步继续执行；不符合获取当前记录的单链表的下一条记录，将该记录作为新的当前记录，跳回步骤二。另外步骤3还会判断当前记录是否符合形成扫描区间的边界条件，不符合跳过步骤4和步骤5，直接向server发送“查询完毕”的信息。</p> <p>需注意，<strong>步骤3不会释放锁</strong>。</p> <p>步骤4：执行回表操作。</p> <p>二级索引回表，查到聚簇索引并给该记录加记录锁。</p> <p>步骤5：判断边界条件是否成立。</p> <p>符合边界条件，继续执行步骤6；否则在隔离级别不大于读提交时，释放该记录锁，并向server层返回“查询完毕”的信息。</p> <p>步骤6：server层判断其余搜索条件是否成立。</p> <p>如果成立，将该记录发送到客户端；否则在隔离级别不大于读提交时，释放该记录锁。</p> <p>步骤7：获取当前记录所在单链表的下一条记录，并将其作为新的当前记录，并跳回步骤2。</p> <h4 id="特殊情况下的加锁"><a href="#特殊情况下的加锁" class="header-anchor">#</a> 特殊情况下的加锁</h4> <p>1、UPDATE语句 与上述流程类似，不过，如果更新了二级索引，那么所有被更新的二级索引记录在更新之前都需要加 X型记录锁。</p> <p>2、DETELE语句 与上述流程类似，不过，如果表中包含二级索引，那么删除记录前要加 X型记录锁。</p> <p>3、<strong>精确匹配</strong>。<strong>隔离级别不大于 读提交 时</strong>，则不会为扫描区间的后面下一条记录加 记录锁；<strong>隔离级别不小于 可重复读 时</strong>，会为扫描区间后面的下一条记录加 <strong>间隙锁</strong>。</p> <p>4、<strong>不是精确匹配，没有找到匹配的记录</strong>。当隔离级别不小于<strong>可重复读</strong>时，为扫描区间的后面下一条记录加 <strong>临键锁</strong> 。</p> <p>5、当隔离级别不小于<strong>可重复读</strong>时，如果使用的<strong>聚簇索引</strong>，并且扫描的区间是<strong>左闭区间</strong>，而且<strong>定位到的第一条聚簇索引记录 与 扫描区间中最小值相同</strong>，那么会为该聚簇索引加 <strong>记录锁</strong>。</p> <p>6、<strong>无论哪个隔离级别</strong>，只要是<strong>唯一性搜索</strong>，并且读到的记录被标记为“<strong>已删除</strong>”，为读取到的记录加 <strong>记录锁</strong>。</p> <p>7、一般扫描记录是从左到右，如果<strong>扫描是从右到左</strong>，当<strong>隔离级别不小于可重复读时</strong>，匹配到第一条记录的下一条记录加 <strong>间隙锁</strong>。</p> <h3 id="半一致性读语句"><a href="#半一致性读语句" class="header-anchor">#</a> 半一致性读语句</h3> <p><strong>当隔离级别不大于读提交 且执行 UPDATE语句时</strong>，称为半一致性读。</p> <p>即UPDATE语句读到已经被其他事务加了X锁记录时，InnoDB会把最新版本的记录读出来，然后判断该版本是否与UPDATE语句中搜索条件相匹配。</p> <p>不匹配，不对该记录加锁，跳到下一条记录；如果匹配，再次读取该记录并加锁。</p> <p>目的：尽量减少UPDATE语句被别的语句阻塞。</p> <h3 id="insert语句"><a href="#insert语句" class="header-anchor">#</a> INSERT语句</h3> <p>INSERT语句一般情况下不需要在内存中生成锁结构，并单纯依靠 <strong>隐式锁</strong> 保护插入的记录。</p> <p>插入记录前需要先在B+树中定位到记录的位置，<strong>如果该位置的下一条记录被加了 间隙锁 或者 临键锁，那么当前事务会为该记录加上 插入意向锁</strong>。</p> <p>执行INSERT语句，在内存中生成锁结构的两种特殊情况：遇到重复键、外键检查。</p> <p><strong>1、遇到重复键</strong></p> <p>遇到重复记录的主键和唯一二级索引时会报错，但是在报错之前会给记录加 <strong>S锁</strong>。</p> <p>主键重复，在不同隔离级别的加锁类型不同：</p> <ul><li>隔离级别为 <strong>读未提交</strong> 时，加的是 <strong>记录锁</strong>。</li> <li>隔离级别<strong>不小于可重复读</strong>时，加的是 <strong>临键锁</strong>。</li></ul> <p><strong>二级唯一索引重复，不管什么隔离级别都加 临键锁。</strong></p> <p><strong>2、外键检查</strong></p> <p>待插记录的外键值可以在父表中匹配到，给父表的这条记录加 记录锁。</p> <p>如果在父表中没有匹配到，会插入失败，并且：</p> <ul><li>隔离级别不大于读提交时，不加锁</li> <li>隔离级别不小于可重复读时，加 间隙锁。</li></ul> <h2 id="加锁情况总结"><a href="#加锁情况总结" class="header-anchor">#</a> 加锁情况总结</h2> <ol><li>普通SELECT语句不加锁，主要依赖MVCC机制。</li> <li>锁定读情况：
<ol><li>一般情况下，在隔离级别<strong>不大于 读提交</strong> 时，会为当前记录加<strong>记录锁</strong>。在隔离级别<strong>不小于 可重复读</strong> 时，会为记录加<strong>临键锁</strong>。</li> <li><strong>UPDATE语句更新二级索引</strong> 或 <strong>DELETE语句删除记录中包含二级索引</strong>，需要加 <strong>X型记录锁</strong>。</li> <li><strong>精确匹配</strong>。<strong>隔离级别不大于 读提交 时</strong>，则不会为扫描区间的后面下一条记录加 <strong>记录锁</strong>；<strong>隔离级别不小于 可重复读 时</strong>，会为扫描区间后面的下一条记录加 <strong>间隙锁</strong>。</li> <li><strong>不是精确匹配，没有找到匹配的记录</strong>。当隔离级别不小于<strong>可重复读</strong>时，为扫描区间的后面下一条记录加 <strong>临键锁</strong> 。</li> <li>当隔离级别不小于<strong>可重复读</strong>时，如果使用的<strong>聚簇索引</strong>，并且扫描的区间是<strong>左闭区间</strong>，而且<strong>定位到的第一条聚簇索引记录 与 扫描区间中最小值相同</strong>，那么会为该聚簇索引加 <strong>记录锁</strong>。</li> <li><strong>无论哪个隔离级别</strong>，只要是<strong>唯一性搜索</strong>，并且读到的记录被标记为“<strong>已删除</strong>”，为读取到的记录加 <strong>记录锁</strong>。</li> <li>一般扫描记录是从左到右，如果<strong>扫描是从右到左</strong>，当<strong>隔离级别不小于可重复读时</strong>，匹配到第一条记录的下一条记录加 <strong>间隙锁</strong>。</li></ol></li> <li>半一致性读语句：<strong>UPDATE语句读到已经被其他事务加了X锁记录时，InnoDB会把最新版本的记录读出来，然后判断该版本是否与UPDATE语句中搜索条件相匹配</strong>。不匹配，不对该记录加锁，跳到下一条记录；**
如果匹配，再次读取该记录并加锁**。</li> <li>INSERT语句：
<ol><li>主键重复，在不同隔离级别的加锁类型不同：隔离级别为 <strong>读未提交</strong> 时，加的是 <strong>记录锁</strong>。隔离级别<strong>不小于可重复读</strong>时，加的是 <strong>临键锁</strong>。</li> <li><strong>二级唯一索引重复，不管什么隔离级别都加 临键锁。</strong></li> <li>外键检查
<ol><li>待插记录的外键值可以在父表中<strong>匹配到</strong>，给父表的这条记录加 <strong>记录锁</strong>。</li> <li>如果在父表中<strong>没有匹配到</strong>，会插入失败，并且：隔离级别不大于读提交时，不加锁；<strong>隔离级别不小于可重复读时，加 间隙锁</strong>。</li></ol></li></ol></li></ol> <h2 id="查看事务的加锁情况"><a href="#查看事务的加锁情况" class="header-anchor">#</a> 查看事务的加锁情况</h2> <h3 id="使用-information-schema-数据库中的表获取锁信息"><a href="#使用-information-schema-数据库中的表获取锁信息" class="header-anchor">#</a> 使用 information_schema 数据库中的表获取锁信息</h3> <p>在数据库 information_schema 中，有几个表和事务、锁有关。</p> <p>1、<code>INNODB_TRX</code>：该表存储了InnoDB存储引擎当前正在执行的事务信息。包括：事务id，事务状态等。</p> <p>其中重点有几个属性值得关注：</p> <ul><li><code>trx_tables_locked</code>：表示该事务目前加了多少个表级锁</li> <li><code>trx_rows_locked</code>：表示该事务目前加了多少个行级锁（不包括隐式锁）</li> <li><code>trx_lock_structs</code>：表示生成该事物生成了多少个内存结构的锁</li></ul> <p>2、<code>INNODB_LOCKS</code>：该表记录了一些锁信息：</p> <ul><li>如果一个事务想要获取到某个锁但未获取到，则记录该锁信息</li> <li>如果一个事务获取到锁，但是这个锁阻塞了别的事务，则记录该锁信息。</li></ul> <p>3、<code>INNODB_LOCK_WAITS</code>：表明每个阻塞事务是因为获取不到那个事务持有的锁而阻塞。</p> <h3 id="使用-show-eninge-innodb-status-获取锁信息"><a href="#使用-show-eninge-innodb-status-获取锁信息" class="header-anchor">#</a> 使用 SHOW ENINGE INNODB STATUS 获取锁信息</h3> <p>略</p> <h2 id="死锁问题"><a href="#死锁问题" class="header-anchor">#</a> 死锁问题</h2> <p>T1和T2都在等待对方先释放掉与自己需要的锁相冲突的锁，因此T1和T2都不能继续执行，此时就称发生了死锁。</p> <p>例子：</p> <table><thead><tr><th>发生时间编号</th> <th>T1</th> <th>T2</th></tr></thead> <tbody><tr><td>1</td> <td>BEGIN;</td> <td></td></tr> <tr><td>2</td> <td></td> <td>BEGIN;</td></tr> <tr><td>3</td> <td>SELECT * FROM hero WHERE number=1 FOR UPDATE;</td> <td></td></tr> <tr><td>4</td> <td></td> <td>SELECT * FROM hero WHERE number=3 FOR UPDATE;</td></tr> <tr><td>5</td> <td>SELECT * FROM hero WHERE number=3 FOR UPDATE; <br>（此操作阻塞）</td> <td></td></tr> <tr><td>6</td> <td></td> <td>SELECT * FROM hero WHERE number=1 FOR UPDATE; <br>（死锁发生，记录日志，服务器回滚一个事务）</td></tr> <tr><td></td> <td></td> <td></td></tr></tbody></table> <p>**死锁检测机制：**检测死锁，会选择一个较小的事务（增删改记录条数较少），并向客户端发送一条报错信息。</p> <p>可通过语句 <code>SELECT ENGINE INNODB STATUS</code> 查看最近一次死锁发生的信息。</p> <h2 id="参看"><a href="#参看" class="header-anchor">#</a> 参看：</h2> <ul><li>《MySQL是怎样运行的》</li> <li><a href="https://zhuanlan.zhihu.com/p/149228460" target="_blank" rel="noopener noreferrer">把MySQL中的各种锁及其原理都画出来<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/213814000" target="_blank" rel="noopener noreferrer">Mysql里的锁(排它锁、共享锁、行锁、表锁、间隙锁、临键锁、意向锁)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/31537871" target="_blank" rel="noopener noreferrer">什么是悲观锁和乐观锁<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/29150809" target="_blank" rel="noopener noreferrer">MySQL锁总结<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></section> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/duktig666/share-blog/edit/main/docs/sql/mysql/MySQL的锁机制.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2023/3/21 11:08:00</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#mysql加锁的目的是什么" class="sidebar-link reco-side-mysql加锁的目的是什么" data-v-b57cc07c>MySQL加锁的目的是什么？</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#mysql的锁是基于什么实现的" class="sidebar-link reco-side-mysql的锁是基于什么实现的" data-v-b57cc07c>MySQL的锁是基于什么实现的？</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#解决并发事务问题的方式" class="sidebar-link reco-side-解决并发事务问题的方式" data-v-b57cc07c>解决并发事务问题的方式</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#写写情况" class="sidebar-link reco-side-写写情况" data-v-b57cc07c>写写情况</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#读写或写读情况" class="sidebar-link reco-side-读写或写读情况" data-v-b57cc07c>读写或写读情况</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#一致性读" class="sidebar-link reco-side-一致性读" data-v-b57cc07c>一致性读</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#锁定读" class="sidebar-link reco-side-锁定读" data-v-b57cc07c>锁定读</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#写操作" class="sidebar-link reco-side-写操作" data-v-b57cc07c>写操作</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#锁的内存结构" class="sidebar-link reco-side-锁的内存结构" data-v-b57cc07c>锁的内存结构</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#基本介绍" class="sidebar-link reco-side-基本介绍" data-v-b57cc07c>基本介绍</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#锁结构的变化" class="sidebar-link reco-side-锁结构的变化" data-v-b57cc07c>锁结构的变化：</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#哪些记录可以放在一个锁结构中" class="sidebar-link reco-side-哪些记录可以放在一个锁结构中" data-v-b57cc07c>哪些记录可以放在一个锁结构中？</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#锁结构详解" class="sidebar-link reco-side-锁结构详解" data-v-b57cc07c>锁结构详解</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#锁的分类" class="sidebar-link reco-side-锁的分类" data-v-b57cc07c>锁的分类</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#共享锁和排它锁-读写锁" class="sidebar-link reco-side-共享锁和排它锁-读写锁" data-v-b57cc07c>共享锁和排它锁（读写锁）</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#共享锁" class="sidebar-link reco-side-共享锁" data-v-b57cc07c>共享锁</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#排它锁" class="sidebar-link reco-side-排它锁" data-v-b57cc07c>排它锁</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#读写意向锁" class="sidebar-link reco-side-读写意向锁" data-v-b57cc07c>读写意向锁</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#表锁" class="sidebar-link reco-side-表锁" data-v-b57cc07c>表锁</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#什么是表锁" class="sidebar-link reco-side-什么是表锁" data-v-b57cc07c>什么是表锁？</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#显式加表锁" class="sidebar-link reco-side-显式加表锁" data-v-b57cc07c>显式加表锁</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#什么时候释放表锁" class="sidebar-link reco-side-什么时候释放表锁" data-v-b57cc07c>什么时候释放表锁？</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#表级别的s锁、x锁" class="sidebar-link reco-side-表级别的s锁、x锁" data-v-b57cc07c>表级别的S锁、X锁</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#表级别的is锁、ix锁" class="sidebar-link reco-side-表级别的is锁、ix锁" data-v-b57cc07c>表级别的IS锁、IX锁</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#表级别的auto-inc锁" class="sidebar-link reco-side-表级别的auto-inc锁" data-v-b57cc07c>表级别的AUTO-INC锁</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#行锁" class="sidebar-link reco-side-行锁" data-v-b57cc07c>行锁</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#什么是行锁" class="sidebar-link reco-side-什么是行锁" data-v-b57cc07c>什么是行锁？</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#行锁的原理" class="sidebar-link reco-side-行锁的原理" data-v-b57cc07c>行锁的原理</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#行锁的类型" class="sidebar-link reco-side-行锁的类型" data-v-b57cc07c>行锁的类型</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#记录锁-record-lock" class="sidebar-link reco-side-记录锁-record-lock" data-v-b57cc07c>记录锁（Record Lock）</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#间隙锁-gap-lock" class="sidebar-link reco-side-间隙锁-gap-lock" data-v-b57cc07c>间隙锁（Gap Lock）</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#临键锁-next-key-lock" class="sidebar-link reco-side-临键锁-next-key-lock" data-v-b57cc07c>临键锁(Next-Key Lock)</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#插入意向锁-lock-insert-intention" class="sidebar-link reco-side-插入意向锁-lock-insert-intention" data-v-b57cc07c>插入意向锁（LOCKINSERTINTENTION）</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#隐式锁" class="sidebar-link reco-side-隐式锁" data-v-b57cc07c>隐式锁</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#加锁语句分析" class="sidebar-link reco-side-加锁语句分析" data-v-b57cc07c>加锁语句分析</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#普通select语句" class="sidebar-link reco-side-普通select语句" data-v-b57cc07c>普通SELECT语句</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#锁定读的语句" class="sidebar-link reco-side-锁定读的语句" data-v-b57cc07c>锁定读的语句</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#半一致性读语句" class="sidebar-link reco-side-半一致性读语句" data-v-b57cc07c>半一致性读语句</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#insert语句" class="sidebar-link reco-side-insert语句" data-v-b57cc07c>INSERT语句</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#加锁情况总结" class="sidebar-link reco-side-加锁情况总结" data-v-b57cc07c>加锁情况总结</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#查看事务的加锁情况" class="sidebar-link reco-side-查看事务的加锁情况" data-v-b57cc07c>查看事务的加锁情况</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#使用-information-schema-数据库中的表获取锁信息" class="sidebar-link reco-side-使用-information-schema-数据库中的表获取锁信息" data-v-b57cc07c>使用 information_schema 数据库中的表获取锁信息</a></li><li class="level-3" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#使用-show-eninge-innodb-status-获取锁信息" class="sidebar-link reco-side-使用-show-eninge-innodb-status-获取锁信息" data-v-b57cc07c>使用 SHOW ENINGE INNODB STATUS 获取锁信息</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#死锁问题" class="sidebar-link reco-side-死锁问题" data-v-b57cc07c>死锁问题</a></li><li class="level-2" data-v-b57cc07c><a href="/./2022/01/21/mysql%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/#参看" class="sidebar-link reco-side-参看" data-v-b57cc07c>参看：</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----></div></div>
    <script src="./assets/js/app.7a1bd950.js" defer></script><script src="./assets/js/3.cb5ac92f.js" defer></script><script src="./assets/js/1.a307db49.js" defer></script><script src="./assets/js/122.d932197c.js" defer></script><script src="./assets/js/10.6878b594.js" defer></script>
  </body>
</html>
