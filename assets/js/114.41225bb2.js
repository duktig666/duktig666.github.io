(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{543:function(s,a,t){"use strict";t.r(a);var n=t(3),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"es实现站内搜索"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#es实现站内搜索"}},[s._v("#")]),s._v(" ES实现站内搜索")]),s._v(" "),a("h3",{attrs:{id:"es实现站内搜索-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#es实现站内搜索-2"}},[s._v("#")]),s._v(" ES实现站内搜索")]),s._v(" "),a("h4",{attrs:{id:"流程图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#流程图"}},[s._v("#")]),s._v(" 流程图")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/koala010/typora/raw/master/img/ElasticSearch%E7%AB%99%E5%86%85%E6%90%9C%E7%B4%A2%E6%B5%81%E7%A8%8B%E5%9B%BE.png",alt:"image-20210203092957723"}})]),s._v(" "),a("h4",{attrs:{id:"站内搜索实现分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#站内搜索实现分析"}},[s._v("#")]),s._v(" 站内搜索实现分析")]),s._v(" "),a("p",[s._v("以小米手机搜索为例，来进行站内搜索的分析：")]),s._v(" "),a("p",[s._v("①在前端搜索框输入搜索词，利用ES的ik分词器进行分词，到ES进行快速检索；")]),s._v(" "),a("p",[s._v("②ES中存储关键信息，一般为一条记录的唯一标识信息和可进行分词检索的信息（例如小米手机可以根据手机名和价格进行检索，那么将id、手机名还有价格的手机信息存储到ES中）")]),s._v(" "),a("p",[s._v("③检索到的信息返回给前端")]),s._v(" "),a("p",[s._v("④前端点击手机信息，例如小米11，那么用ES检索出的手机ID去数据库查询小米11的详细信息。")]),s._v(" "),a("p",[s._v("⑤可以利用搜索词的搜索频度存储到redis，用来实现热搜排行榜等功能（具体的业务引入具体的技术）")]),s._v(" "),a("p",[s._v("⑥利用远程词典可以控制ik分词器不能分词的网络热词")]),s._v(" "),a("p",[a("strong",[s._v("⑦关键点在于数据库与ES的数据同步方案。")])]),s._v(" "),a("h3",{attrs:{id:"springboot整合springdata-elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboot整合springdata-elasticsearch"}},[s._v("#")]),s._v(" SpringBoot整合SpringData ElasticSearch")]),s._v(" "),a("p",[s._v("ElasticSearch的更新迭代比较快，目前已经迭代到了7.x版本。使用SpringBoot整合SpringData ElasticSearch对版本的要求比较高。这里我们使用SpringBoot 2.3.x（比如"),a("code",[s._v("2.3.8.RELEASE")]),s._v("）,对应可以使用ElasticSearch7.x。")]),s._v(" "),a("h4",{attrs:{id:"_1-引入依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-引入依赖"}},[s._v("#")]),s._v(" 1. 引入依赖：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("\t"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("boot"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("boot"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("starter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("parent"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.3")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RELEASE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("parent"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        \n    "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependencies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" elasticsearch "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("boot"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("boot"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("starter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("elasticsearch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dependency"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" 其余依赖视情况引入 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dependencies"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"_2-配置application-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置application-yml"}},[s._v("#")]),s._v(" 2.配置application.yml")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# elasticsearch")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uris")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_3-编写实体类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-编写实体类"}},[s._v("#")]),s._v(" 3.编写实体类")]),s._v(" "),a("p",[s._v("可以将数据库的实体类抽离出来，依据上述站内搜索的分析，将一条记录的唯一标识和可分词检索的字段存储到ES中。ES实体的属性对应es存储的字段。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Document")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("indexName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"phone"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Data")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Accessors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("chain "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MenuES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Id")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Field")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FieldType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Text")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" analyzer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ik_max_word"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Field")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FieldType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Text")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" analyzer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ik_max_word"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h4",{attrs:{id:"_4-编写repository类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-编写repository类"}},[s._v("#")]),s._v(" 4.编写Repository类")]),s._v(" "),a("p",[s._v("SpringData Elasticsearch的Repository和SpringData JPA使用上极其类似。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MenuRepository")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ElasticsearchRepository")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MenuES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("泛型第一个类型对应ES实体类，第二个对应主键的类型。")]),s._v(" "),a("h4",{attrs:{id:"_5-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-测试"}},[s._v("#")]),s._v(" 5.测试")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SpringBootTest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AppRun")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RunWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringJUnit4ClassRunner")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestSpringDataElasticSearch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MenuRepository")]),s._v(" menuRepository"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 添加索引和更新索引 id 存在更新 不存在添加\n     */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testSaveOrUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MenuES")]),s._v(" menu "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MenuES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        menu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"系统管理"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"系统管理"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        menuRepository"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("menu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 查询所有\n     */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testFindAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iterable")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MenuES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" menuIterable "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" menuRepository"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MenuES")]),s._v(" menu "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" menuIterable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("menu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 查询一个\n     */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testFindOne")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Optional")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MenuES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" byId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" menuRepository"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("byId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("p",[s._v("这里只是举出了一个简单的例子，具体SpringBoot整合ElasticSearch实现站内搜索功能要看具体的业务逻辑。")]),s._v(" "),a("h3",{attrs:{id:"mysql与es数据同步方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql与es数据同步方案"}},[s._v("#")]),s._v(" MySQL与ES数据同步方案")]),s._v(" "),a("p",[s._v("数据同步效果主要分为两种"),a("strong",[s._v("实时同步")]),s._v("和"),a("strong",[s._v("最终同步")]),s._v("。")]),s._v(" "),a("p",[s._v("实时同步对同步频率要求较高。需要保证mysql数据发生增删改变更后，需要立马将变更后的数据同步给ES；保证ES检索到的数据近乎实时都是准确的。")]),s._v(" "),a("p",[s._v("最终同步对同步频率要求不高，但需要保证最终数据库与ES的数据是一致的。至于“最终”这个时间段时多少，根据不同的业务场景，确定不同的时间。")]),s._v(" "),a("h4",{attrs:{id:"方案一-业务逻辑实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案一-业务逻辑实现"}},[s._v("#")]),s._v(" 方案一：业务逻辑实现")]),s._v(" "),a("h5",{attrs:{id:"实现方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现方式"}},[s._v("#")]),s._v(" 实现方式")]),s._v(" "),a("p",[s._v("使用SpringData ElasticSearch可以快速进行ES相关的操作，在进行mysql增删改操作的同时，对ES所对应的索引库进行增删改操作，以保持数据的一致性。")]),s._v(" "),a("p",[s._v("从实现角度考虑，这样的方式属于数据实时同步。但是可能在数据同步的时候会出现一些问题：")]),s._v(" "),a("ol",[a("li",[s._v("只有当mysql执行增删改成功之后，才可以进行ES操作的执行，在代码实现的角度考虑，会使业务变得更加复杂。这个问题在这个实现方式下，基本不可避免。")]),s._v(" "),a("li",[s._v("如果mysql执行成功，但是ES执行失败，怎么处理？如果不处理会引起数据不一致的问题。")])]),s._v(" "),a("h5",{attrs:{id:"问题及解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题及解决"}},[s._v("#")]),s._v(" 问题及解决")]),s._v(" "),a("p",[s._v("首先，这样的问题没有必要从事务的角度考虑，即mysql执行成功，ES执行失败，mysql执行回退操作，没有必要让mysql重新执行。")]),s._v(" "),a("p",[s._v("所以，可以考虑的点还是从ES数据补偿的角度出发，可以将ES同步失败的数据缓存到redis或者是消息中间件（例如RabbitMQ），等待服务器不忙碌的时候（例如凌晨2点），将redis/消息中间件中的数据同步到ES中，采用订阅消费模式，直至未同步的数据同步到ES，确保数据一致性。")]),s._v(" "),a("p",[s._v("这样的解决方案，在一定的程度上降低了数据同步的实时性，但是也确保了数据的最终一致性。")]),s._v(" "),a("h5",{attrs:{id:"分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析"}},[s._v("#")]),s._v(" 分析")]),s._v(" "),a("h6",{attrs:{id:"优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[s._v("#")]),s._v(" 优点：")]),s._v(" "),a("ol",[a("li",[s._v("逻辑简单，代码实现容易。")]),s._v(" "),a("li",[s._v("保证了数据的最终一致性，在一定程度上保证了数据同步的实时性（如果ES没有问题，即可保证数据的实时同步，但这是不现实的）。")])]),s._v(" "),a("h6",{attrs:{id:"缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[s._v("#")]),s._v(" 缺点：")]),s._v(" "),a("ol",[a("li",[s._v("ES的数据同步与业务的耦合性太大，不方便维护和扩展。")]),s._v(" "),a("li",[s._v("数据库数据变更一次，就要同步一次ES数据，数据同步过于频繁。")]),s._v(" "),a("li",[s._v("从数据同步的实时性出发，但是并不能保证数据同步的实时性（虽然保证了数据同步的最终一致性）。")])]),s._v(" "),a("h4",{attrs:{id:"方案二-消息中间件-redis-定时任务实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案二-消息中间件-redis-定时任务实现"}},[s._v("#")]),s._v(" 方案二：消息中间件/redis+定时任务实现")]),s._v(" "),a("p",[s._v("为了解决数据同步频繁的问题，并主要实现数据最终同步的目的，故出现了这个方案。")]),s._v(" "),a("h5",{attrs:{id:"实现方式-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现方式-2"}},[s._v("#")]),s._v(" 实现方式")]),s._v(" "),a("p",[s._v("实现方式与上文的业务逻辑方式类似，只是在mysql数据发生增删改变更的时候，不直接将变更的数据同步到ES，而是先缓存到redis或者消息中间件，等到流量低（例如凌晨2点）的时间利用定时任务将数据同步给ES，采用订阅/消费模式直到数据同步成功为止。")]),s._v(" "),a("h5",{attrs:{id:"分析-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析-2"}},[s._v("#")]),s._v(" 分析")]),s._v(" "),a("h6",{attrs:{id:"优点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点-2"}},[s._v("#")]),s._v(" 优点")]),s._v(" "),a("ol",[a("li",[s._v("实现了数据最终同步")]),s._v(" "),a("li",[s._v("降低了服务器压力，不再频繁地进行数据同步")])]),s._v(" "),a("h6",{attrs:{id:"缺点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点-2"}},[s._v("#")]),s._v(" 缺点")]),s._v(" "),a("ol",[a("li",[s._v("即使借助消息中间件和redis，数据同步也与业务耦合比较大")]),s._v(" "),a("li",[s._v("数据同步内嵌在代码中")])]),s._v(" "),a("h4",{attrs:{id:"方案三-借助插件实现数据同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案三-借助插件实现数据同步"}},[s._v("#")]),s._v(" 方案三：借助插件实现数据同步")]),s._v(" "),a("p",[s._v("MySQL与ElasticSearch数据同步的插件有很多，在这里列出来常用的一些，例如 ：")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/jprante/elasticsearch-jdbc",target:"_blank",rel:"noopener noreferrer"}},[s._v("elasticsearch-jdbc"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/scharron/elasticsearch-river-mysql",target:"_blank",rel:"noopener noreferrer"}},[s._v("elasticsearch-river-mysql"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/siddontang/go-mysql-elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[s._v("go-mysql-elasticsearch"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/logstash-plugins/logstash-input-jdbc",target:"_blank",rel:"noopener noreferrer"}},[s._v("logstash-input-jdbc"),a("OutboundLink")],1)])]),s._v(" "),a("h5",{attrs:{id:"插件优缺点对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件优缺点对比"}},[s._v("#")]),s._v(" 插件优缺点对比")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("插件名称")]),s._v(" "),a("th",[s._v("优点")]),s._v(" "),a("th",[s._v("缺点")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("elasticsearch-jdbc")]),s._v(" "),a("td",[s._v("1.相对通用"),a("br"),s._v("2.GitHub活跃度高，版本更新快")]),s._v(" "),a("td",[s._v("不能实现同步删除操作mysql删除了，ES仍然存在")])]),s._v(" "),a("tr",[a("td",[s._v("elasticsearch-river-mysql")]),s._v(" "),a("td",[s._v("版本太旧，不再考虑")]),s._v(" "),a("td",[s._v("2012年12月13日后便不再更新")])]),s._v(" "),a("tr",[a("td",[s._v("go-mysql-elasticsearch")]),s._v(" "),a("td",[s._v("1.国内作者开发"),a("br"),s._v("2.能实现同步增删改查操作")]),s._v(" "),a("td",[s._v("1.仍处于开发阶段，相对不稳定"),a("br"),s._v("2.没有日志，不方便排查问题和查看同步结果")])]),s._v(" "),a("tr",[a("td",[s._v("logstash-input-jdbc")]),s._v(" "),a("td",[s._v("1.能实现同步增、改操作的增量、全量数据同步"),a("br"),s._v("2.版本更新快、相对稳定"),a("br"),s._v("3.集成在LogStash，作为ES生态固有插件的一部分，易用")]),s._v(" "),a("td",[s._v("不能实现同步删除操作mysql删除了，ES仍然存在")])])])]),s._v(" "),a("p",[a("em",[s._v("严格意义上elasticsearch-jdbc已经不是第三方插件，已经成为独立的第三方工具。")])]),s._v(" "),a("h5",{attrs:{id:"分析-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析-3"}},[s._v("#")]),s._v(" 分析")]),s._v(" "),a("p",[s._v("插件比较多，经过对比分析选择"),a("code",[s._v("logstash-input-jdbc")]),s._v("较为合适，版本更新快、稳定，而且作为LogStash的一款插件，而且现在LogStash的版本已经默认集成了该插件，后来要使用日志可视化（ELK）也会用到LogStash。虽然有不能实现同步删除的操作，但是如果数据库字段采用的逻辑删除，则可以完美避免这个问题，逻辑删除刚好符合我们的场景。")]),s._v(" "),a("h4",{attrs:{id:"方案四-canal-alibaba"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案四-canal-alibaba"}},[s._v("#")]),s._v(" 方案四：canal(alibaba)")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/alibaba/canal",target:"_blank",rel:"noopener noreferrer"}},[s._v("canal"),a("OutboundLink")],1),s._v("——mysql数据库binlog的增量订阅&消费组件。")]),s._v(" "),a("h5",{attrs:{id:"分析-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析-4"}},[s._v("#")]),s._v(" 分析")]),s._v(" "),a("p",[s._v("推荐使用场景 canal适用于对于Mysql和Elasticsearch数据实时增、删、改要求高的业务场景。 实时场景要求不高的业务场景，logstash-input-jdbc也能满足。")]),s._v(" "),a("p",[s._v("建议，做好选型甄别。")]),s._v(" "),a("h6",{attrs:{id:"优点-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点-3"}},[s._v("#")]),s._v(" 优点")]),s._v(" "),a("ol",[a("li",[s._v("基于binlog实现，支持增删改同步实现")]),s._v(" "),a("li",[s._v("阿里开源，网上有很多具体实现方案")]),s._v(" "),a("li",[s._v("SpringBoot引入canal客户端，canal可监听数据变化，做相应的业务处理")])]),s._v(" "),a("h6",{attrs:{id:"缺点-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点-3"}},[s._v("#")]),s._v(" 缺点")]),s._v(" "),a("ol",[a("li",[s._v("不支持全量同步")])]),s._v(" "),a("h3",{attrs:{id:"logstash-input-jdbc实现mysql与es的数据同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logstash-input-jdbc实现mysql与es的数据同步"}},[s._v("#")]),s._v(" logstash-input-jdbc实现mysql与ES的数据同步")]),s._v(" "),a("p",[s._v("LogStash在5.x版本已经默认集成logstash-input-jdbc插件，新版本的LogStash不用再单独下载插件，直接使用LogStash就可以完成mysql与ES的数据同步。")]),s._v(" "),a("p",[s._v("下载完成LogStash，编写"),a("code",[s._v("jdbc.conf")]),s._v("文件（可以自定义命名）。"),a("code",[s._v("jdbc.conf")]),s._v("我放在了LogStash的"),a("code",[s._v("config")]),s._v("的目录下（可以更换）。")]),s._v(" "),a("p",[s._v("LogStash官网下载速度比较慢，可以考虑从国内镜像下载： "),a("a",{attrs:{href:"https://www.newbe.pro/Mirrors/Mirrors-Logstash/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.newbe.pro/Mirrors/Mirrors-Logstash/"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"全量同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全量同步"}},[s._v("#")]),s._v(" 全量同步")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  jdbc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql连接地址")]),s._v("\n    jdbc_connection_string "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jdbc:mysql://localhost:3306/smpe?serverTimezone=Asia/Shanghai&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql账号")]),s._v("\n    jdbc_user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql密码")]),s._v("\n    jdbc_password "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"159357asd"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Java连接mysql的驱动jar包（最好与数据库的版本对应）")]),s._v("\n    jdbc_driver_library "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\javaweb'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\E"}},[s._v("\\E")]),s._v('lasticsearch\\logstash-7.10.0\\mysql\\mysql-connector-java-8.0.12.jar"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql连接驱动名")]),s._v("\n    jdbc_driver_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.mysql.cj.jdbc.Driver"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否支持分页")]),s._v("\n    jdbc_paging_enabled "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每页显示的条数")]),s._v("\n    jdbc_page_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置时区")]),s._v("\n\tjdbc_default_timezone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 具体的sql，将哪些数据同步到es")]),s._v("\n    statement "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"select id,name,title from sys_menu"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以将statement换成statement_filepath将sql语句写到额外的文件里")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# statement_filepath => "D:\\javaweb\\Elasticsearch\\logstash-7.10.0\\config\\jdbc.sql"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同步的频率/时间 第一位是分钟 不设置就是1分钟执行一次")]),s._v("\n    schedule "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* * * * *"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\noutput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  elasticsearch "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# es的ip和端口")]),s._v("\n    hosts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:9200"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同步的索引")]),s._v("\n    index "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"menu"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# id")]),s._v("\n    document_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%{id}"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    codec "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" json_lines\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("h4",{attrs:{id:"增量同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增量同步"}},[s._v("#")]),s._v(" 增量同步")]),s._v(" "),a("p",[s._v("增量同步主要改动以下项")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果使用更新时间来追踪增量，那么值设置为false；如果为其他字段追踪，如id，值设置为true")]),s._v("\nuse_column_value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 追踪增量的字段")]),s._v("\ntracking_column "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置记录上一次的增量的值")]),s._v("\nrecord_last_run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将上一次增量的值存储的文件")]),s._v("\nlast_run_metadata_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\javaweb'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\E"}},[s._v("\\E")]),s._v("lasticsearch\\logstash-7.10.0"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('onfig\\.logstash_jdbc_last_run"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 增量同步，sql后跟where子句，即"where 追踪字段 > :sql_last_value"')]),s._v("\nstatement "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"select id,name,title from sys_menu where id > :sql_last_value"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("增量同步完全文件"),a("code",[s._v("jdbc.conf")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  jdbc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql连接地址")]),s._v("\n    jdbc_connection_string "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jdbc:mysql://localhost:3306/smpe?serverTimezone=Asia/Shanghai&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql账号")]),s._v("\n    jdbc_user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql密码")]),s._v("\n    jdbc_password "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"159357asd"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Java连接mysql的驱动jar包（最好与数据库的版本对应）")]),s._v("\n    jdbc_driver_library "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\javaweb'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\E"}},[s._v("\\E")]),s._v('lasticsearch\\logstash-7.10.0\\mysql\\mysql-connector-java-8.0.12.jar"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql连接驱动名")]),s._v("\n    jdbc_driver_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.mysql.cj.jdbc.Driver"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否支持分页")]),s._v("\n    jdbc_paging_enabled "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每页显示的条数")]),s._v("\n    jdbc_page_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置时区")]),s._v("\n\tjdbc_default_timezone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果使用更新时间来追踪增量，那么值设置为false；如果为其他字段追踪，如id，值设置为true")]),s._v("\n\tuse_column_value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 追踪增量的字段")]),s._v("\n\ttracking_column "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置记录上一次的增量的值")]),s._v("\n\trecord_last_run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将上一次增量的值存储的文件")]),s._v("\n\tlast_run_metadata_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\javaweb'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\E"}},[s._v("\\E")]),s._v("lasticsearch\\logstash-7.10.0"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('onfig\\.logstash_jdbc_last_run"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 增量同步，sql后跟where子句，即"where 追踪字段 > :sql_last_value"')]),s._v("\n\tstatement "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"select id,name,title from sys_menu where id > :sql_last_value"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同步的频率/时间 第一位是分钟 不设置就是1分钟执行一次")]),s._v("\n    schedule "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* * * * *"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\noutput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  elasticsearch "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# es的ip和端口")]),s._v("\n    hosts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:9200"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同步的索引")]),s._v("\n    index "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"menu"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# id")]),s._v("\n    document_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%{id}"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    codec "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" json_lines\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br")])]),a("p",[s._v("配置完成"),a("code",[s._v("jdbc.conf")]),s._v("后，进入"),a("code",[s._v("bin")]),s._v("目录使用命令启动LogStash（启动前要先启动ES）")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" logstash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/config/jdbc.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"canal实现mysql与es的数据同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#canal实现mysql与es的数据同步"}},[s._v("#")]),s._v(" canal实现mysql与ES的数据同步")]),s._v(" "),a("p",[s._v("下载"),a("code",[s._v("canal.deployer")])]),s._v(" "),a("p",[s._v("修改"),a("code",[s._v("conf/example/instance.properties")]),s._v("文件，主要修改以下几处：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("canal.instance.master.address")]),s._v("：数据库地址，例如127.0.0.1:3306")]),s._v(" "),a("li",[a("code",[s._v("canal.instance.dbUsername")]),s._v("：数据库用户")]),s._v(" "),a("li",[a("code",[s._v("canal.instance.dbPassword")]),s._v("：数据库密码")])]),s._v(" "),a("p",[s._v("完整"),a("code",[s._v("conf/example/instance.properties")]),s._v("文件：")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#################################################")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mysql serverId , v1.0.26+ will autoGen")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# canal.instance.mysql.slaveId=0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# enable gtid use true/false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.gtidon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# position info")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.master.address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("127.0.0.1:3306")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.master.journal.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.master.position")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.master.timestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.master.gtid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rds oss binlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.rds.accesskey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.rds.secretkey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.rds.instanceId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# table meta tsdb info")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.tsdb.enable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.tsdb.url=jdbc:mysql://127.0.0.1:3306/canal_tsdb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.tsdb.dbUsername=canal")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.tsdb.dbPassword=canal")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.standby.address =")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.standby.journal.name =")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.standby.position =")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.standby.timestamp =")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.standby.gtid=")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# username/password")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.dbUsername")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("root")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.dbPassword")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("159357asd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.connectionCharset")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("UTF-8")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# enable druid Decrypt database password")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.enableDruid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.pwdPublicKey=MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALK4BUxdDltRRE5/zXpVEVPUgunvscYFtEip3pmLlhrWpacX7y7GCMo2/JM6LeHmiiNdH1FWgGCpUfircSwlWKUCAwEAAQ==")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# table regex")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.filter.regex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(".*\\\\..*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# table black regex")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.filter.black.regex=mysql\\\\.slave_.*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.instance.filter.black.regex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# table field filter(format: schema1.tableName1:field1/field2,schema2.tableName2:field1/field2)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.filter.field=test1.t_product:id/subject/keywords,test2.t_company:id/name/contact/ch")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# table field black filter(format: schema1.tableName1:field1/field2,schema2.tableName2:field1/field2)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.instance.filter.black.field=test1.t_product:subject/product_image,test2.t_company:id/name/contact/ch")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mq config")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.mq.topic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("example")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dynamic topic route by schema or table regex")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.mq.dynamicTopic=mytest1.user,mytest2\\\\..*,.*\\\\..*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("canal.mq.partition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# hash partition config")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.mq.partitionsNum=3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.mq.partitionHash=test.table:id^name,.*\\\\..*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#canal.mq.dynamicTopicPartitionNum=test.*:4,mycanal:6")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#################################################")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br")])]),a("p",[s._v("下载"),a("code",[s._v("canal.adapter")])]),s._v(" "),a("p",[s._v("修改"),a("code",[s._v("conf/application.yml")]),s._v("文件，主要修改")]),s._v(" "),a("ul",[a("li",[s._v("server.port:canal-adapter端口号")]),s._v(" "),a("li",[s._v("canal.conf.canalServerHost:canal-server地址和ip")]),s._v(" "),a("li",[s._v("canal.conf.srcDataSources.defaultDS.url:数据库地址")]),s._v(" "),a("li",[s._v("canal.conf.srcDataSources.defaultDS.username:数据库用户名")]),s._v(" "),a("li",[s._v("canal.conf.srcDataSources.defaultDS.password:数据库密码")]),s._v(" "),a("li",[s._v("canal.conf.canalAdapters.groups.outerAdapters.hosts:es主机地址,tcp端口")])]),s._v(" "),a("p",[s._v("完整文件如下：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jackson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("date-format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yyyy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("MM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dd HH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("mm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ss\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("time-zone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" GMT+8\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default-property-inclusion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" non_null\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("canal.conf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp kafka rocketMQ rabbitMQ")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("flatMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("zookeeperHosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("syncBatchSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secretKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("consumerProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# canal tcp consumer")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("canal.tcp.server.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11111")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("canal.tcp.zookeeper.hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("canal.tcp.batch.size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("canal.tcp.username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("canal.tcp.password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kafka consumer")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka.bootstrap.servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9092")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka.enable.auto.commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka.auto.commit.interval.ms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka.auto.offset.reset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka.request.timeout.ms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka.session.timeout.ms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka.isolation.level")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" read_committed\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka.max.poll.records")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rocketMQ consumer")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rocketmq.namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rocketmq.namesrv.addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rocketmq.batch.size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rocketmq.enable.message.trace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rocketmq.customized.trace.topic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rocketmq.access.channel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rocketmq.subscribe.filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rabbitMQ consumer")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rabbitmq.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rabbitmq.virtual.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rabbitmq.username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rabbitmq.password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rabbitmq.resource.ownerId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("srcDataSources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("defaultDS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jdbc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3306/smpe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("serverTimezone=Asia/Shanghai"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 159357asd\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("canalAdapters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" example "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# canal instance Name or mq topic name")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("groups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" g1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("outerAdapters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logger\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      - name: rdb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        key: mysql1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        properties:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.driverClassName: com.mysql.jdbc.Driver")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.url: jdbc:mysql://127.0.0.1:3306/mytest2?useUnicode=true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.username: root")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.password: 121212")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      - name: rdb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        key: oracle1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        properties:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.driverClassName: oracle.jdbc.OracleDriver")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.url: jdbc:oracle:thin:@localhost:49161:XE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.username: mytest")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.password: m121212")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      - name: rdb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        key: postgres1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        properties:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.driverClassName: org.postgresql.Driver")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.url: jdbc:postgresql://localhost:5432/postgres")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.username: postgres")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          jdbc.password: 121212")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          threads: 1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          commitSize: 3000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      - name: hbase")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        properties:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          hbase.zookeeper.quorum: 127.0.0.1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          hbase.zookeeper.property.clientPort: 2181")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          zookeeper.znode.parent: /hbase")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" es7\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" example\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 127.0.0.1:9200 for rest mode")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rest "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#transport or rest")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          # security.auth: test:123456 #  only used for rest mode")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" elasticsearch\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        - name: kudu")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          key: kudu")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          properties:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#            kudu.master.address: 127.0.0.1 # ',' split multi address")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br")])]),a("p",[s._v("另外需要配置"),a("code",[s._v("conf/es/*.yml")]),s._v("文件，adapter将会自动加载conf / es下的所有.yml结尾的配置文件。以"),a("code",[s._v("test.yml")]),s._v("为例：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dataSourceKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" defaultDS\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" example\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("esMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("_index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" menu\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("_type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" _doc\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" _id\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  upsert: true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"select id as _id,name,title from sys_menu "')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  etlCondition: \"where update_time>='{0}'\" #etl的条件参数，可以将之前没能同步的数据同步，数据量大的话可以用logstash")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("commitBatch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("然后分别在"),a("code",[s._v("canal.deployer")]),s._v("和"),a("code",[s._v("canal.adapter")]),s._v("的bin目录启动deployer和adapter")]),s._v(" "),a("p",[s._v("测试增删改mysql数据，也可以同步数据到ES。")]),s._v(" "),a("h3",{attrs:{id:"对比logstash和canal同步mysql和es的数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对比logstash和canal同步mysql和es的数据"}},[s._v("#")]),s._v(" 对比LogStash和Canal同步mysql和ES的数据")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th"),s._v(" "),a("th",[s._v("LogStash")]),s._v(" "),a("th",[s._v("Canal")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("全量同步")]),s._v(" "),a("td",[s._v("支持")]),s._v(" "),a("td",[s._v("不支持")])]),s._v(" "),a("tr",[a("td",[s._v("增量同步")]),s._v(" "),a("td",[s._v("支持")]),s._v(" "),a("td",[s._v("支持")])]),s._v(" "),a("tr",[a("td",[s._v("mysql删除同步")]),s._v(" "),a("td",[s._v("不支持（可采用逻辑删除）")]),s._v(" "),a("td",[s._v("支持")])]),s._v(" "),a("tr",[a("td",[s._v("ES7.x兼容性")]),s._v(" "),a("td",[s._v("好")]),s._v(" "),a("td",[s._v("目前不友好（mysql增删改可以监听到，但是数据不能同步到ES）")])]),s._v(" "),a("tr",[a("td",[s._v("实时性")]),s._v(" "),a("td",[s._v("较低")]),s._v(" "),a("td",[s._v("较高")])])])]),s._v(" "),a("p",[s._v("如果选用ES6.x，那么这两种方案其实都可行。")]),s._v(" "),a("p",[s._v("如果选用ES7.X，那么目前LogStash会合适一些，Canal对ES7.X的兼容性还并不好，如果canalv1.1.5版本发布稳定版了可以再考虑使用。")])])}),[],!1,null,null,null);a.default=e.exports}}]);