(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{587:function(t,e,s){"use strict";s.r(e);var a=s(3),r=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),e("h3",{attrs:{id:"tls"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tls"}},[t._v("#")]),t._v(" TLS")]),t._v(" "),e("p",[t._v("传输层安全性协议（英语：Transport Layer Security，缩写：TLS）及其前身安全套接层（英语：Secure Sockets Layer，缩写：SSL）是一种安全协议，目的是为互联网通信提供安全及数据完整性保障。")]),t._v(" "),e("p",[t._v("TLS协议采用"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E4%B8%BB%E5%BE%9E%E5%BC%8F%E6%9E%B6%E6%A7%8B",target:"_blank",rel:"noopener noreferrer"}},[t._v("主从式架构"),e("OutboundLink")],1),t._v("模型，用于在两个应用程序间透过网络创建起安全的连线，防止在交换资料时受到"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E7%AB%8A%E8%81%BD",target:"_blank",rel:"noopener noreferrer"}},[t._v("窃听"),e("OutboundLink")],1),t._v("及篡改。")]),t._v(" "),e("p",[t._v("TLS协议的优势是与高层的"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E5%BA%94%E7%94%A8%E5%B1%82",target:"_blank",rel:"noopener noreferrer"}},[t._v("应用层"),e("OutboundLink")],1),t._v("协议（如"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP"),e("OutboundLink")],1),t._v("、"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE",target:"_blank",rel:"noopener noreferrer"}},[t._v("FTP"),e("OutboundLink")],1),t._v("、"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/Telnet",target:"_blank",rel:"noopener noreferrer"}},[t._v("Telnet"),e("OutboundLink")],1),t._v("等）无耦合。应用层协议能透明地运行在TLS协议之上，由TLS协议进行创建加密通道需要的协商和认证。应用层协议传送的数据在通过TLS协议时都会被加密，从而保证通信的私密性。")]),t._v(" "),e("p",[t._v("在客户端和服务器开始交换TLS所保护的加密信息之前，他们必须安全地交换或协定加密密钥和加密数据时要使用的密码。在交换过程中使用的"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E5%85%AC%E5%BC%80%E5%AF%86%E9%92%A5%E5%8A%A0%E5%AF%86",target:"_blank",rel:"noopener noreferrer"}},[t._v("公钥/私钥"),e("OutboundLink")],1),t._v("加密"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E5%AF%86%E9%92%A5",target:"_blank",rel:"noopener noreferrer"}},[t._v("密钥"),e("OutboundLink")],1),t._v("的长度和在交换协议过程中使用的公钥证书也各不相同，因而提供的"),e("strong",[t._v("强健性")]),t._v("的安全。")]),t._v(" "),e("blockquote",[e("p",[t._v("参看：\n"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E5%82%B3%E8%BC%B8%E5%B1%A4%E5%AE%89%E5%85%A8%E6%80%A7%E5%8D%94%E5%AE%9A",target:"_blank",rel:"noopener noreferrer"}},[t._v("TLS（维基百科）"),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSL/TLS协议运行机制"),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/158711125",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSL，HTTPS，TLS三者的区别"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"pkcs12"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pkcs12"}},[t._v("#")]),t._v(" PKCS12")]),t._v(" "),e("p",[t._v("p12 文件包含使用 PKCS#12（公钥加密标准 #12）加密的**"),e("a",{attrs:{href:"https://techterms.com/definition/certificate",target:"_blank",rel:"noopener noreferrer"}},[t._v("数字证书。"),e("OutboundLink")],1),t._v("**它用作传输个人私钥和其他敏感信息的便携式格式。P12 文件被各种安全和加密程序使用。")]),t._v(" "),e("p",[t._v("P12 密钥存储一个私钥，该私钥以这样一种方式**"),e("a",{attrs:{href:"https://techterms.com/definition/encryption",target:"_blank",rel:"noopener noreferrer"}},[t._v("加密"),e("OutboundLink")],1),t._v("**信息，即只能通过相应的公钥对其进行解密。同样，用公钥加密的数据只能用私钥解密。这有助于验证传输信息的来源。")]),t._v(" "),e("blockquote",[e("p",[t._v("参看：\n"),e("a",{attrs:{href:"https://blog.freessl.cn/ssl-cert-format-introduce/",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSL 证书格式普及，PEM、CER、JKS、PKCS12"),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://zh.m.wikipedia.org/zh-hans/PKCS_12",target:"_blank",rel:"noopener noreferrer"}},[t._v("PKCS12（维基百科）"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"证书生成-p12-keystore-和-truststore文件理解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#证书生成-p12-keystore-和-truststore文件理解"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://www.cnblogs.com/nhdlb/p/12258225.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("证书生成 .p12 .keyStore 和 .truststore文件理解"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("strong",[t._v(".p12(PKCS #12)")])]),t._v(" "),e("p",[t._v("我们的每一个证书都可以生成一个.p12文件，这个文件是一个加密的文件，只要知道其密码，就可以供给所有的系统设备使用，使设备不需要在重新申请开发和发布证书，就能使用。")]),t._v(" "),e("p",[e("em",[t._v("注意：一般.p12文件是给与别人使用的，本机必须已经有一个带秘钥的证书才可以生成.p12文件")])]),t._v(" "),e("p",[e("strong",[t._v(".keystore(密钥库)")])]),t._v(" "),e("p",[t._v("keystore中一般保存的是我们的私钥，用来加解密或者为别人做签名用。")]),t._v(" "),e("p",[e("strong",[t._v(".truststore(信任库)")])]),t._v(" "),e("p",[t._v("truststore中保存的是一些可信任的证书，主要是java在代码中访问某个https的时候对被访问者进行认证的，以确保其实可信任的。")]),t._v(" "),e("p",[t._v("truststore是必须的，如果我们没有显式的指定，那么java会默认指定为$JAVA_HOME/lib/security/cacerts 这个文件。")]),t._v(" "),e("p",[e("strong",[t._v(".p12一般存放的是生成的（服务器端或客户端）证书与密钥，类似打包存放。")])]),t._v(" "),e("p",[e("strong",[t._v(".keystore一般存放的是（服务器端或客户端）证书与密钥，或直接存放 .p12 文件包。")])]),t._v(" "),e("p",[e("strong",[t._v(".truststore一般存放的是系统根证书与密钥信息。")])]),t._v(" "),e("h2",{attrs:{id:"使用cert-manager配置pkcs12"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用cert-manager配置pkcs12"}},[t._v("#")]),t._v(" 使用cert-manager配置PKCS12")]),t._v(" "),e("h2",{attrs:{id:"定义证书颁发机构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定义证书颁发机构"}},[t._v("#")]),t._v(" 定义证书颁发机构")]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[t._v("apiVersion"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("cert"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manager.io/v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Issuer\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" selfsigned"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("issuer\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myNamespace\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selfSigned")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br")])]),e("p",[t._v("也可以定义集群全局的证书颁发机构：")]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cert"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manager.io/v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterIssuer\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" selfsigned"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("issuer\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selfSigned")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("h3",{attrs:{id:"定义p12证书的密码文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定义p12证书的密码文件"}},[t._v("#")]),t._v(" 定义P12证书的密码文件")]),t._v(" "),e("p",[t._v("这里使用K8s的secret")]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pkcs12 Secret")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pkcs12"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secret\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Opaque\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要转换成 base64 格式")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# echo -n "your password" | base64')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("p12_password.txt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" .Values.helmCode "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br")])]),e("h3",{attrs:{id:"定义证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定义证书"}},[t._v("#")]),t._v(" 定义证书")]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# create certificate for pkcs12")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cert"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manager.io/v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Certificate\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myCert\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pkcs12 密钥库的配置")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystores")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pkcs12")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建p12文件")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("create")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("passwordSecretRef")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pkcs12"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secret\n\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 引用secret中的密码")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" p12_password.txt\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置合适的dns myService为当前服务的service")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dnsNames")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" myService\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" myService.myNamespace\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" myService.myNamespace.svc\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" myService.myNamespace.svc.cluster.local\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 技巧：使用相同的secret，会进行文件合并")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pkcs12"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secret\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要配置commonName，否则可能出现问题")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commonName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myService\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 证书时间 10年")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("duration")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 87600h\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("issuerRef")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" selfsigned"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("issuer\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用集群全局issuer，需要配置kind")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterIssuer\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br"),e("span",{staticClass:"line-number"},[t._v("23")]),e("br"),e("span",{staticClass:"line-number"},[t._v("24")]),e("br"),e("span",{staticClass:"line-number"},[t._v("25")]),e("br"),e("span",{staticClass:"line-number"},[t._v("26")]),e("br"),e("span",{staticClass:"line-number"},[t._v("27")]),e("br"),e("span",{staticClass:"line-number"},[t._v("28")]),e("br"),e("span",{staticClass:"line-number"},[t._v("29")]),e("br"),e("span",{staticClass:"line-number"},[t._v("30")]),e("br"),e("span",{staticClass:"line-number"},[t._v("31")]),e("br")])]),e("p",[e("strong",[t._v("keystores")])]),t._v(" "),e("blockquote",[e("p",[e("em",[t._v("(Optional)")])]),t._v(" "),e("p",[t._v("Keystores configures additional keystore output formats stored in the "),e("strong",[e("code",[t._v("secretName")])]),t._v(" Secret resource.")])]),t._v(" "),e("p",[e("strong",[t._v("CertificateKeystores")])]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("jks | pkcs12")]),t._v(" "),e("em",[e("a",{attrs:{href:"https://cert-manager.io/v1.8-docs/reference/api-docs/#cert-manager.io/v1.PKCS12Keystore",target:"_blank",rel:"noopener noreferrer"}},[t._v("PKCS12Keystore"),e("OutboundLink")],1),t._v("(Optional)")]),t._v(" PKCS12 configures options for storing a PKCS12 keystore in the "),e("strong",[e("code",[t._v("spec.secretName")])]),t._v("\n Secret resource.")])]),t._v(" "),e("p",[e("strong",[t._v("create")]),t._v(" "),e("em",[t._v("bool")])]),t._v(" "),e("p",[t._v("Create enables PKCS12 keystore creation for the Certificate. If true, a file named **"),e("code",[t._v("keystore.p12")]),t._v("**will be created in the target Secret resource, encrypted using the password stored in "),e("strong",[e("code",[t._v("passwordSecretRef")])]),t._v(". The keystore file will only be updated upon re-issuance. A file named **"),e("code",[t._v("truststore.p12")]),t._v("**will also be created in the target Secret resource, encrypted using the password stored in **"),e("code",[t._v("passwordSecretRef")]),t._v("**containing the issuing Certificate Authority")]),t._v(" "),e("p",[t._v("创建启用证书的PKCS12密钥库创建。如果为true，将在目标秘密资源中创建一个名为keystore.p12的文件，该文件使用存储在passwordsecretref中的密码进行加密。重新发行时，密钥库文件只会更新。一个名为TrustStore.p12的文件也将在目标秘密资源中创建，并使用存储的密码加密，该密码已存储在Passwordsecretref中")]),t._v(" "),e("p",[t._v("passwordSecretRef")]),t._v(" "),e("blockquote",[e("p",[e("em",[e("a",{attrs:{href:"https://cert-manager.io/v1.8-docs/reference/api-docs/#meta.cert-manager.io/v1.SecretKeySelector",target:"_blank",rel:"noopener noreferrer"}},[t._v("SecretKeySelector"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("PasswordSecretRef is a reference to a key in a Secret resource containing the password used to encrypt the PKCS12 keystore.")])]),t._v(" "),e("p",[t._v("具体参看："),e("a",{attrs:{href:"https://cert-manager.io/v1.8-docs/reference/api-docs/#cert-manager.io/v1.PKCS12Keystore",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://cert-manager.io/v1.8-docs/reference/api-docs/#cert-manager.io/v1.PKCS12Keystore"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("strong",[t._v("commonName的说明")])]),t._v(" "),e("p",[t._v("如果不加可能报错：")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("java.security.cert.CertificateParsingException: Empty issuer DN not allowed "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" X509Certificates\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("blockquote",[e("p",[t._v("参看:")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/cert-manager/cert-manager/issues/3634",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/cert-manager/cert-manager/issues/3634"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/kubernetes-client/java/issues/1926",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/kubernetes-client/java/issues/1926"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"生成相应文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成相应文件"}},[t._v("#")]),t._v(" 生成相应文件")]),t._v(" "),e("ul",[e("li",[t._v("ca.crt")]),t._v(" "),e("li",[t._v("keystore.p12")]),t._v(" "),e("li",[t._v("tls.crt")]),t._v(" "),e("li",[t._v("tls.key")]),t._v(" "),e("li",[t._v("truststore.p12")]),t._v(" "),e("li",[t._v("p12_password.txt")])]),t._v(" "),e("h2",{attrs:{id:"k8s-自动化引用pkcs12证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k8s-自动化引用pkcs12证书"}},[t._v("#")]),t._v(" K8s 自动化引用PKCS12证书")]),t._v(" "),e("p",[t._v("我们已经将pkcs12的证书，还有密码文件生成到名为 "),e("code",[t._v("pkcs12-secret")]),t._v(" 的secret当中，只要将此secret挂载到pod的pv中即可使用相应的文件。")]),t._v(" "),e("p",[t._v("使用pkcs12服务端和客户端都需要相应的证书配置，具体如何使用，需参看具体的使用场景。")]),t._v(" "),e("p",[t._v("使用K8s的yaml或者helm将cert-manager的配置写到整个流程中，即可完成全流程的pkcs12的TLS配置。")]),t._v(" "),e("blockquote",[e("p",[t._v("参看："),e("a",{attrs:{href:"https://www.qikqiak.com/post/use-secret-in-k8s/",target:"_blank",rel:"noopener noreferrer"}},[t._v("secret使用"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"参看"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参看"}},[t._v("#")]),t._v(" 参看")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E5%82%B3%E8%BC%B8%E5%B1%A4%E5%AE%89%E5%85%A8%E6%80%A7%E5%8D%94%E5%AE%9A",target:"_blank",rel:"noopener noreferrer"}},[t._v("TLS（维基百科）"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSL/TLS协议运行机制"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/158711125",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSL，HTTPS，TLS三者的区别"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://blog.freessl.cn/ssl-cert-format-introduce/",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSL 证书格式普及，PEM、CER、JKS、PKCS12"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://zh.m.wikipedia.org/zh-hans/PKCS_12",target:"_blank",rel:"noopener noreferrer"}},[t._v("PKCS12（维基百科）"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.cnblogs.com/nhdlb/p/12258225.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("证书生成 .p12 .keyStore 和 .truststore文件理解"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://cert-manager.io/v1.8-docs/reference/api-docs/#cert-manager.io/v1.PKCS12Keystore",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://cert-manager.io/v1.8-docs/reference/api-docs/#cert-manager.io/v1.PKCS12Keystore"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.qikqiak.com/post/use-secret-in-k8s/",target:"_blank",rel:"noopener noreferrer"}},[t._v("secret使用"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=r.exports}}]);